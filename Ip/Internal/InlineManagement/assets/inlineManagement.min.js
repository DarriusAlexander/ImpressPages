(function($){"use strict";$(document).ready(function(){$('.ipModuleInlineManagement.ipmLogo').ipModuleInlineManagementLogo();$('.ipModuleInlineManagement.ipmText').ipModuleInlineManagementText();$('.ipModuleInlineManagement.ipmImage').ipModuleInlineManagementImage();});})(ip.jQuery);(function($){"use strict";var hideTimer=0,controlsClass='ipModuleInlineManagementControls',hiliteClass='ipmHilite',methods={init:function(options){return this.each(function(){var $this=$(this);if(!$('.'+controlsClass).length){$('body').append(ipModInlineManagementControls);}
var $controls=$('.'+controlsClass);$controls.off('mouseenter').on('mouseenter',function(event){clearTimeout(hideTimer);}).off('mouseleave').on('mouseleave',function(event){hideTimer=setTimeout(function(){$controls.hide();$('.'+hiliteClass).removeClass(hiliteClass);},30);});var data=$this.data('ipModuleInlineManagementControls');if(!data){$this.data('ipModuleInlineManagementControls',{initiated:1}).mouseenter(function(e){clearTimeout(hideTimer);$('.'+hiliteClass).removeClass(hiliteClass);$this.addClass(hiliteClass);var objOffset=$this.offset();$controls.css({left:objOffset.left,top:objOffset.top}).show()
for(var key in options){$controls.find('.ipActionWidget'+key).show().off().on('click',function(event){event.preventDefault();if($.isFunction(options[key])){options[key]();}});}}).mouseleave(function(e){hideTimer=setTimeout(function(){$controls.hide();$('.'+hiliteClass).removeClass(hiliteClass);},30);});}});}};$.fn.ipModuleInlineManagementControls=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementControls');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipInlineManagementImage');if(!data){$this.data('ipInlineManagementImage',{key:$this.data('key'),cssClass:$this.data('cssclass'),options:$this.data('options'),defaultValue:$this.data('defaultvalue')}).ipModuleInlineManagementControls({'Manage':function(){$this.trigger('ipModuleInlineManagement.openEditPopup');}}).bind('ipModuleInlineManagement.openEditPopup',$.proxy(methods.openPopup,$this));}});},openPopup:function(){var $this=this;$this.css('width','');$this.css('height','');var data=Object();data.aa='InlineManagement.getManagementPopupImage';data.securityToken=ip.securityToken;data.key=$this.data('ipInlineManagementImage').key;data.zoneName=ip.zoneName;data.pageId=ip.pageId;data.languageId=ip.languageId;$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:methods._openPopupResponse,dataType:'json'});},_openPopupResponse:function(response){var $this=this;if(response.status=='success'){var $overlay=$('<div class="ui-widget-overlay"></div>').appendTo("body").css('position','fixed');$overlay.css('z-index',2000);$('.ipModuleInlineManagementPopup.ipmImage').remove();$('body').append('<div class="ipModuleInlineManagementPopup ipmImage ip" ></div>');var $popup=$('.ipModuleInlineManagementPopup.ipmImage');$popup.html(response.html);$popup.css('z-index',2010);$popup.css('position','absolute');$popup.css($this.offset());var data=$this.data('ipInlineManagementImage');data.popup=$popup;data.overlay=$overlay;$this.data('ipInlineManagementImage',data);var imageData=response.imageData;var options=new Object;options.image=imageData.imageOrig;options.cropX1=imageData.x1;options.cropY1=imageData.y1;options.cropX2=imageData.x2;options.cropY2=imageData.y2;if(imageData.requiredWidth){options.windowWidth=imageData.requiredWidth;}
if(imageData.requiredHeight){options.windowHeight=imageData.requiredHeight;}
if(imageData.x2&&!options.windowWidth){options.windowWidth=imageData.x2-imageData.x1;}
if(imageData.y2&&!options.windowHeight){options.windowHeight=imageData.y2-imageData.y1;}
if(!options.windowWidth){options.windowWidth=$this.width();}
if(!options.windowHeight){options.windowHeight=$this.height();}
options.enableChangeWidth=true;options.enableChangeHeight=true;options.enableUnderscale=true;options.minWindowWidth=10;options.minWindowHeight=10;options.maxWindowWidth=2000;options.maxWindowHeight=1000;var inlineOptions=$this.data('options');if(inlineOptions.width){options.windowWidth=inlineOptions.width;options.enableChangeWidth=false;}
if(inlineOptions.height){options.windowHeight=inlineOptions.height;options.enableChangeHeight=false;}
$.each($this.data('options'),function(name,value){options[name]=value;});var $imageUploader=$('.ipModuleInlineManagementPopup.ipmImage').find('.ipsImage');$imageUploader.ipUploadImage(options);$imageUploader.bind('change.ipUploadImage',$.proxy(methods._preview,$this));$this.bind('error.ipUploadImage',{widgetController:this},methods._addError);}
$('.ipModuleInlineManagementPopup.ipmImage').find('.ipsConfirm').bind('click',$.proxy(methods._confirm,$this));$('.ipModuleInlineManagementPopup.ipmImage').find('.ipsCancel').bind('click',$.proxy(methods._cancel,$this));$('.ipModuleInlineManagementPopup.ipmImage').find('.ipsRemove').bind('click',$.proxy(methods._removeImage,$this));},_removeImage:function(event){event.preventDefault();var $this=this;var $popup=$('.ipModuleInlineManagementPopup.ipmImage');if(!confirm($popup.find('.ipsRemoveConfirm').text())){return;}
var data=Object();data.aa='InlineManagement.removeImage';data.key=$this.data('ipInlineManagementImage').key;data.defaultValue=$this.data('ipInlineManagementImage').defaultValue;data.options=$this.data('ipInlineManagementImage').options;data.cssClass=$this.data('ipInlineManagementImage').cssClass;data.securityToken=ip.securityToken;data.zoneName=ip.zoneName;data.pageId=ip.pageId;data.languageId=ip.languageId;data.key=$this.data('ipInlineManagementImage').key;$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:methods._removeResponse,dataType:'json'});},_removeResponse:function(answer){var $this=this;if(answer&&answer.status=='success'){var data=$this.data('ipInlineManagementImage');data.overlay.remove();data.popup.remove();$this.css('width','');$this.css('height','');if(answer.newHtml){var $newHtml=$(answer.newHtml);$this.replaceWith($newHtml);$newHtml.ipModuleInlineManagementImage();}}},_preview:function(event){var $this=this;var $popup=$('.ipModuleInlineManagementPopup.ipmImage');var $imageUploader=$popup.find('.ipsImage');var windowHeight=$imageUploader.ipUploadImage('height');var windowWidth=$imageUploader.ipUploadImage('width');$popup.find('.ipsControls').css('width',(windowWidth-20)+'px');$this.css('width',windowWidth+'px');$this.css('height',(windowHeight+$popup.find('.ipsControls').height()+20)+'px');},_confirm:function(event){event.preventDefault();var $this=$(this);var $popup=$('.ipModuleInlineManagementPopup.ipmImage');$this.trigger('ipInlineManagement.logoConfirm');var data=Object();data.aa='InlineManagement.saveImage';data.securityToken=ip.securityToken;data.key=$this.data('ipInlineManagementImage').key;data.defaultValue=$this.data('ipInlineManagementImage').defaultValue;data.options=$this.data('ipInlineManagementImage').options;data.cssClass=$this.data('ipInlineManagementImage').cssClass;data.type=$popup.find('.ipsType').val();data.zoneName=ip.zoneName;data.pageId=ip.pageId;data.languageId=ip.languageId;var ipUploadImage=$('.ipModuleInlineManagementPopup.ipmImage').find('.ipsImage');if(ipUploadImage.ipUploadImage('getCurImage')==undefined){$.proxy(methods._cancel,$this)(event);return;}
if(ipUploadImage.ipUploadImage('getNewImageUploaded')){var newImage=ipUploadImage.ipUploadImage('getCurImage');if(newImage){data.newImage=newImage;}}
if(ipUploadImage.ipUploadImage('getCropCoordinatesChanged')&&ipUploadImage.ipUploadImage('getCurImage')!=false){var cropCoordinates=ipUploadImage.ipUploadImage('getCropCoordinates');if(cropCoordinates){data.cropX1=cropCoordinates.x1;data.cropY1=cropCoordinates.y1;data.cropX2=cropCoordinates.x2;data.cropY2=cropCoordinates.y2;data.windowWidth=ipUploadImage.ipUploadImage('getImageWidth');data.windowHeight=ipUploadImage.ipUploadImage('getImageHeight');}}
$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:methods._confirmResponse,dataType:'json'});},_confirmResponse:function(answer){var $this=this;if(answer&&answer.status=='success'){var data=$this.data('ipInlineManagementImage');data.overlay.remove();data.popup.remove();$this.css('width','');$this.css('height','');if(answer.newHtml){var $newHtml=$(answer.newHtml);$this.replaceWith($newHtml);$newHtml.ipModuleInlineManagementImage();}}},_cancel:function(event){event.preventDefault();var $this=this;var data=$this.data('ipInlineManagementImage');data.overlay.remove();data.popup.remove();$this.css('width','');$this.css('height','');}};$.fn.ipModuleInlineManagementImage=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementImage');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipInlineManagementLogo');if(!data){$this.data('ipInlineManagementLogo',{'originalLogo':$this.clone(),'imageUploadInitialized':false,'cssClass':$this.data('cssClass')})
$this.bind('ipModuleInlineManagementLogo.openEditPopup',$.proxy(openEditPopup,$this));$this.ipModuleInlineManagementControls({'Manage':function(){$this.trigger('ipModuleInlineManagementLogo.openEditPopup');}});}});}};var updateType=function(){var $this=this;var $popup=$('#ipInlineLogoModal');if($this.data('typeSelectText').is(':checked')){$this.data('textManagement').show();$this.data('imageManagement').hide();}else{$this.data('textManagement').hide();$this.data('imageManagement').show();if(!$this.data('ipInlineManagementLogo').imageUploadInitialized){var $imageUploader=$popup.find('.ipsImage');$imageUploader.ipUploadImage($this.data('ipUploadImageOptions'));var data=$this.data('ipInlineManagementLogo');data.imageUploadInitialized=true;$this.data('ipInlineManagementLogo',data);$imageUploader.bind('change.ipUploadImage',$.proxy(preview,$this));}}
$.proxy(preview,$this)();};var openEditPopup=function(event){event.preventDefault();var $this=$(this);$('#ipInlineLogoModal').remove();var $this=this;var data=Object();data.aa='InlineManagement.getManagementPopupLogo';data.securityToken=ip.securityToken;data.cssClass=$this.data('cssclass');$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:popupContentResponse,dataType:'json'});};var confirm=function(event){event.preventDefault();var $this=$(this);var $popup=$('#ipInlineLogoModal');$this.trigger('ipInlineManagement.logoConfirm');var data=Object();data.aa='InlineManagement.saveLogo';data.securityToken=ip.securityToken;data.cssClass=$this.data('ipInlineManagementLogo').cssClass;if($this.data('typeSelectText').is(':checked')){data.type='text';}else{data.type='image';}
data.text=$this.data('logoText').val();data.color=$this.data('colorPicker').css('background-color');data.font=$this.data('fontSelect').ipInlineManagementFontSelector('getFont');if($this.data('ipInlineManagementLogo').imageUploadInitialized){var ipUploadImage=$popup.find('.ipsImage');if(ipUploadImage.ipUploadImage('getNewImageUploaded')){var newImage=ipUploadImage.ipUploadImage('getCurImage');if(newImage){data.newImage=newImage;}}
if(ipUploadImage.ipUploadImage('getCropCoordinatesChanged')&&ipUploadImage.ipUploadImage('getCurImage')!=false){var cropCoordinates=ipUploadImage.ipUploadImage('getCropCoordinates');if(cropCoordinates){data.cropX1=cropCoordinates.x1;data.cropY1=cropCoordinates.y1;data.cropX2=cropCoordinates.x2;data.cropY2=cropCoordinates.y2;data.windowWidth=ipUploadImage.ipUploadImage('width');data.windowHeight=ipUploadImage.ipUploadImage('height');}}}
$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:confirmResponse,dataType:'json'});};var confirmResponse=function(answer){var $this=this;var $modal=$('#ipInlineLogoModal');if(answer&&answer.status=='success'){$modal.modal('hide');if(answer.logoHtml){var $newLogo=$(answer.logoHtml);$this.replaceWith($newLogo);$newLogo.ipModuleInlineManagementLogo();}
$this.trigger('ipInlineManagement.logoConfirm');}};var cancel=function(){var $this=this;$this.show();$this.data('previewText').remove();$this.data('previewImage').remove();var data=$this.data('ipInlineManagementLogo');data.imageUploadInitialized=false;$this.data('ipInlineManagementLogo',data);$this.trigger('ipInlineManagement.logoCancel');}
var popupContentResponse=function(response){var $this=this;var $responseHtml=$(response.html);$('body').append($responseHtml);var $modal=$responseHtml.find('#ipInlineLogoModal');$modal.modal();$this.data('typeSelectText',$modal.find('.ipmTypeSelect input[value=text]'));$this.data('typeSelectImage',$modal.find('.ipmTypeSelect input[value=image]'));$this.data('textManagement',$modal.find('.ipmTextManagement'));$this.data('imageManagement',$modal.find('.ipmImageManagement'));$this.data('fontSelect',$modal.find('.ipmFontSelect'));$this.data('colorPicker',$modal.find('.ipmColorPicker'));$this.data('logoText',$modal.find('.ipmLogoText'));$this.data('previewText',$(response.textPreview));$this.data('previewImage',$(response.imagePreview));$this.after($this.data('previewText'));$this.after($this.data('previewImage'));$this.data('previewImage').hide();$this.data('previewText').hide();var curColor=$this.data('previewText').find('a').css('color');var curText=$.trim($this.data('previewText').find('a').text());var curFont=$this.data('previewText').find('a').css('font-family');$this.data('previewText').find('a').css('font-family','');var defaultFont=$this.data('previewText').find('a').css('font-family');$this.data('previewText').find('a').css('font-family',curFont);$modal.find('ul li.ipmDefaultFont').css('font-family',defaultFont);if(curFont.indexOf(',')==false){curFont=curFont+',sans-serif';}
$this.data('logoText').css('font-family',curFont);$this.data('curFont',curFont);var options=new Object;var logoData=response.logoData;$this.data('curData',logoData);options.image=logoData.imageOrig;options.cropX1=logoData.x1;options.cropY1=logoData.y1;options.cropX2=logoData.x2;options.cropY2=logoData.y2;options.windowWidth=logoData.requiredWidth;options.windowHeight=logoData.requiredHeight;if(logoData.x2&&!options.windowWidth){options.windowWidth=logoData.x2-logoData.x1;}
if(logoData.y2&&!options.windowHeight){options.windowHeight=logoData.y2-logoData.y1;}
if(!options.windowWidth){options.windowWidth=400;}
if(!options.windowHeight){options.windowHeight=100;}
options.enableChangeHeight=true;options.enableChangeWidth=true;options.enableUnderscale=true;options.minWindowWidth=10;options.minWindowHeight=10;options.maxWindowWidth=774;options.maxWindowHeight=310;$this.data('ipUploadImageOptions',options);$this.data('logoText').val(curText);$this.data('logoText').on('keyup',$.proxy(preview,$this));$this.data('fontSelect').ipInlineManagementFontSelector({'hide_fallbacks':true,'initial':curFont,'selected':function(style){$this.data('fontSelect').find('span').css('font-family',style);$this.data('curFont',style);$.proxy(preview,$this)();}});$this.data('colorPicker').css('backgroundColor',curColor);$this.data('colorPicker').ColorPicker({color:curColor,onShow:function(colpkr){$(colpkr).css('zIndex',2000);$(colpkr).fadeIn(300);return false;},onHide:function(colpkr){$(colpkr).fadeOut(300);return false;},onChange:function(hsb,hex,rgb){$this.data('colorPicker').css('backgroundColor','#'+hex);$.proxy(preview,$this)();}});if(logoData.type=='text'){$this.data('typeSelectText').attr('checked','checked');}else{$this.data('typeSelectImage').attr('checked','checked');}
$this.find('.ipmType').buttonset();$modal.find('.ipsImage').one('ready.ipUploadImage',$.proxy(preview,$this));$.proxy(updateType,$this)();$this.data('typeSelectText').bind('change',$.proxy(updateType,$this));$this.data('typeSelectImage').bind('change',$.proxy(updateType,$this));$modal.find('.ipsConfirm').bind('click',$.proxy(confirm,$this));$modal.on('hide.bs.modal',function(){$.proxy(cancel,$this)();});};var preview=function(){var $this=this;var $modal=$('#ipInlineLogoModal');$this.hide();if($this.data('typeSelectText').is(':checked')){$this.data('previewImage').hide();$this.data('previewText').show();$this.data('previewText').find('a').text($this.data('logoText').val());$this.data('previewText').find('a').css('color',$this.data('colorPicker').css('background-color'));$this.data('previewText').find('a').css('font-family',$this.data('curFont'));$this.data('logoText').css('font-family',$this.data('curFont'));}else{$this.data('previewText').hide();$this.data('previewImage').show();var $imageUploader=$modal.find('.ipsImage');$this.data('previewImage').html('<div class="ip"></div>');$this.data('previewImage').find('div').append($imageUploader.find('.ipUploadWindow').clone());$this.data('previewImage').find('.ipUploadButtons').remove();$this.data('previewImage').find('.ui-resizable-handle').remove();}};$.fn.ipModuleInlineManagementLogo=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementLogo');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipInlineManagementText');if(!data){$this.data('ipInlineManagementText',{key:$this.data('key'),cssClass:$this.data('cssclass'),htmlTag:$this.data('htmltag'),defaultValue:$this.data('defaultvalue')});var cssClass=$this.data('ipInlineManagementText').cssClass;var key=$this.data('ipInlineManagementText').key;var htmlTag=$this.data('ipInlineManagementText').htmlTag;var customTinyMceConfig=ipTinyMceConfig();customTinyMceConfig.setup=function(ed,l){ed.on('change',function(e){save($this.html(),key,cssClass,htmlTag);})};$this.tinymce(customTinyMceConfig);}});}};var save=function(html,key,cssClass,htmlTag){event.preventDefault();var $this=$(this);var data=Object();data.aa='InlineManagement.saveText';data.securityToken=ip.securityToken;data.cssClass=cssClass;data.key=key;data.htmlTag=htmlTag;data['values']=[];data['values'][ip.languageId]=html;$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:saveResponse,dataType:'json'});};var saveResponse=function(answer){var $this=this;if(answer&&answer.status=='success'){if(answer.stringHtml){var $newElement=$(answer.stringHtml)
$this.replaceWith($newElement);$newElement.ipModuleInlineManagementText();}
$this.trigger('ipInlineManagement.stringConfirm');$('.ipModuleInlineManagementPopupText').dialog('close');}}
$.fn.ipModuleInlineManagementText=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipInlineManagementText');}};})(ip.jQuery);(function(jQuery){jQuery.fn.ipInlineManagementFontSelector=function(options){if(options=='getFont'){var root=$(this);return root.css('font-family');}
var settings=$.extend({'hide_fallbacks':false,'selected':function(style){},'initial':''},options);return this.each(function(){var root=$(this);var ul=$(this).find('ul');ul.hide();var visible=false;if(settings['initial']!=''){var curFontExists=false;var initialBaseFont=$.trim(settings['initial'].substr(0,settings['initial'].indexOf(',')).replace(/\'/g,''));root.find('li').each(function(){var font=$(this).text();var baseFont=$.trim(font.substr(0,font.indexOf(',')).replace(/\'/g,''));if(baseFont.toLowerCase()==initialBaseFont.toLowerCase()){curFontExists=true;}});if(!curFontExists){var defaultFontLabel=root.find('li.ipmDefaultFont').html();root.find('span').html(defaultFontLabel.substr(0,defaultFontLabel.indexOf(',')));root.css('font-family',root.find('li.ipmDefaultFont').css('font-family'));}else{root.find('span').html(initialBaseFont);root.css('font-family',settings['initial']);}}
ul.find('li').each(function(){$(this).css("font-family",$(this).text());if(settings['hide_fallbacks']){var content=$(this).text();$(this).text(content.substr(0,content.indexOf(',')));}});ul.find('li').click(function(){if(!visible)
return;ul.slideUp('fast',function(){visible=false;});root.find('span').html($(this).text());root.css('font-family',$(this).css('font-family'));if($(this).hasClass('ipmDefaultFont')){settings['selected']('');}else{settings['selected']($(this).css('font-family'));}});$(this).click(function(event){if(visible)
return;event.stopPropagation();ul.slideDown('fast',function(){visible=true;});});$('html').click(function(){if(visible){ul.slideUp('fast',function(){visible=false;});}})});}})(ip.jQuery);