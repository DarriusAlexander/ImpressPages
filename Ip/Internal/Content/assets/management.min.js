var ipContent;(function($){"use strict";ipContent=new function(){this.deleteWidget=function(instanceId,callback){var $widget=$('#ipWidget-'+instanceId);var $subwidgets=$widget.find('.ipWidget');var $this=$(this);var data=Object();data.aa='Content.deleteWidget';data.securityToken=ip.securityToken;data.instanceId=Array();$.each($subwidgets,function(key,widget){var $widget=$(widget);data.instanceId.push($widget.data('widgetinstanceid'));});data.instanceId.push(instanceId);$.ajax({type:'POST',url:ip.baseUrl,data:data,success:function(response){var $block=$widget.closest('.ipBlock');$widget.remove();if($block.children('.ipWidget').length==0){$this.addClass('ipbEmpty');}
var $columnsWidget=$block.closest('.ipWidget-Columns');if($columnsWidget.length){deleteEmptyColumns($columnsWidget.data('widgetinstanceid'),function(){if(callback){callback();}});}},dataType:'json'});}
var deleteEmptyColumns=function(columnsWidgetInstanceId,callback){var $columnsWidget=$('#ipWidget-'+columnsWidgetInstanceId);var $columns=$columnsWidget.find('> .ipsCol');var $emptyColumns=new Array();var $notEmptyColumns=new Array();var columnsWidgetBlockName=$columnsWidget.closest('.ipBlock').data('ipBlock').name;var columnsWidgetPosition=$columnsWidget.index();$.each($columns,function(key,column){var $column=$(column);if($column.find('.ipWidget').length==0){$emptyColumns.push($column);}else{$notEmptyColumns.push($column);}});if($emptyColumns.length+1>=$columns.length){if($notEmptyColumns.length==1){var $notEmptyColumn=$notEmptyColumns[0];$.each($notEmptyColumn.find('.ipWidget'),function(key,widget){var $widget=$(widget);ipContent.moveWidget($widget.data('widgetinstanceid'),columnsWidgetPosition+key,columnsWidgetBlockName,ip.revisionId);});}
ipContent.deleteWidget(columnsWidgetInstanceId,function(){if(callback){callback();}});}else{var emptyColumnNames=new Array();$.each($emptyColumns,function(key,$emptyColumn){emptyColumnNames.push($emptyColumn.find('> .ipBlock').data('ipBlock').name);});if(emptyColumnNames.length>0){ipContent.deleteColumn($columnsWidget.data('widgetinstanceid'),emptyColumnNames,function(){if(callback){callback();}});}else{if(callback){callback();}}}}
this.createWidgetToColumn=function(widgetName,targetWidgetInstanceId,position,callback){var revisionId=ip.revisionId;addColumn(targetWidgetInstanceId,position,function(newWidgetBlockName){ipContent.createWidget(revisionId,newWidgetBlockName,widgetName,0,function(instanceId){var $block=$('#ipBlock-'+newWidgetBlockName);$block.find('.ipbExampleContent').remove();if(callback){callback(instanceId);}});});}
this.moveWidgetToColumn=function(sourceWidgetInstanceId,targetWidgetInstanceId,position,callback){var revisionId=ip.revisionId;addColumn(targetWidgetInstanceId,position,function(newWidgetBlockName){ipContent.moveWidget(sourceWidgetInstanceId,0,newWidgetBlockName,revisionId,function(instanceId){if(callback){callback(instanceId);}});});}
this.moveWidgetToSide=function(sourceWidgetInstanceId,targetWidgetInstanceId,leftOrRight,callback){var revisionId=ip.revisionId;createSpace(targetWidgetInstanceId,leftOrRight,function(newWidgetBlockName){ipContent.moveWidget(sourceWidgetInstanceId,0,newWidgetBlockName,revisionId,function(instanceId){if(callback){callback(instanceId);}});});};this.createWidgetToSide=function(widgetName,targetWidgetInstanceId,leftOrRight,callback){var revisionId=ip.revisionId;createSpace(targetWidgetInstanceId,leftOrRight,function(newWidgetBlockName){ipContent.createWidget(revisionId,newWidgetBlockName,widgetName,0,function(instanceId){var $block=$('#ipBlock-'+newWidgetBlockName);$block.find('.ipbExampleContent').remove();if(callback){callback(instanceId);}});});};this.deleteColumn=function(columnsWidgetInstanceId,columnNames,callback){var widgetData={method:'deleteColumn',columnName:columnNames}
ipContent.updateWidget(columnsWidgetInstanceId,widgetData,1,function(instanceId){if(callback){callback(instanceId);}});}
var addColumn=function(columnWidgetInstanceId,newColPos,callback){var updateData={method:'addColumn',position:newColPos}
ipContent.updateWidget(columnWidgetInstanceId,updateData,true,function(newInstanceId){var $colsWidget=$('#ipWidget-'+newInstanceId);var $newCol=$colsWidget.find('.ipsCol').eq(newColPos);var $newBlock=$newCol.find('.ipBlock');var newBlockName=$newBlock.data('ipBlock').name;if(callback){callback(newBlockName);}});}
var createSpace=function(targetWidgetInstanceId,leftOrRight,callback){var newWidgetBlockName;var $targetWidget=$('#ipWidget-'+targetWidgetInstanceId);var $targetBlock=$targetWidget.closest('.ipBlock');var targetBlockName=$targetBlock.data('ipBlock').name;var targetPosition=$targetWidget.index();var revisionId=ip.revisionId;if($targetWidget.hasClass('ipWidget-Columns')){var colCount=$targetWidget.find('.ipsCol').length;var newColPos;if(leftOrRight=='left'){newColPos=0;}else{newColPos=colCount;}
var updateData={method:'addColumn',position:newColPos}
ipContent.updateWidget(targetWidgetInstanceId,updateData,true,function(newInstanceId){var $colsWidget=$('#ipWidget-'+newInstanceId);var $newCol=$colsWidget.find('.ipsCol').eq(newColPos);var $newBlock=$newCol.find('.ipBlock');var newBlockName=$newBlock.data('ipBlock').name;if(callback){callback(newBlockName);}});}else{ipContent.createWidget(revisionId,targetBlockName,'Columns',targetPosition,function(instanceId){var columnWidgetInstanceId=instanceId;var $columnWidget=$('#ipWidget-'+columnWidgetInstanceId);if(leftOrRight=='left'){var $existingWidgetBlock=$columnWidget.find('.ipBlock').eq(1);var $newWidgetBlock=$columnWidget.find('.ipBlock').eq(0);}else{var $existingWidgetBlock=$columnWidget.find('.ipBlock').eq(0);var $newWidgetBlock=$columnWidget.find('.ipBlock').eq(1);}
var existingWidgetBlockName=$existingWidgetBlock.data('ipBlock').name;newWidgetBlockName=$newWidgetBlock.data('ipBlock').name;ipContent.moveWidget(targetWidgetInstanceId,0,existingWidgetBlockName,revisionId,function(newInstanceId){$('#ipWidget-'+newInstanceId).remove();$columnWidget.ipWidget('save',{},1,function($widget){$widget.closest('.ipBlock').find('.ipbExampleContent').remove();if(callback){callback(newWidgetBlockName);}});});});}}
this.updateWidget=function(instanceId,widgetData,regeneratePreview,callback){var data=Object();var $widget=$('#ipWidget-'+instanceId);data.aa='Content.updateWidget';data.securityToken=ip.securityToken;data.instanceId=instanceId;data.widgetData=widgetData;if(regeneratePreview){data.generatePreview=1}
$.ajax({type:'POST',url:ip.baseUrl,data:data,success:function(response){if(regeneratePreview){var newWidget=response.html;var $newWidget=$(newWidget);$newWidget.insertAfter($widget);$newWidget.trigger('reinitRequired.ipWidget');$(document).ipContentManagement('initBlocks',$newWidget.find('.ipBlock'));$widget.remove();}
if(callback){callback(response.instanceId);}},error:function(response){console.log('save error');console.log(response);if(callback){callback(null);}},dataType:'json'});}
this.createWidget=function(revisionId,block,widgetName,position,callback){var data={};data.aa='Content.createWidget';data.securityToken=ip.securityToken;data.widgetName=widgetName;data.position=position;data.block=block;data.revisionId=revisionId;$.ajax({type:'POST',url:ip.baseUrl,data:data,success:function(response){if(response.status=='error'){alert(response.errorMessage);}
var $block=$('#ipBlock-'+response.block);if($block.hasClass('ipbEmpty')){$block.removeClass('ipbEmpty');}
$block.find(' > .ipbExampleContent').remove();if(response.status=='success'){var $newWidget=$(response.widgetHtml);if(response.position==0){$block.prepend($newWidget);}else{var $secondChild=$block.children('.ipWidget:nth-child('+response.position+')');$newWidget.insertAfter($secondChild);}
$block.trigger('reinitRequired.ipWidget');$block.trigger('addWidget.ipWidget',{'instanceId':response.instanceId,'widget':$newWidget});$(document).ipContentManagement('initBlocks',$newWidget.find('.ipBlock'));var widgetController=$newWidget.ipWidget('widgetController');if(widgetController&&typeof(widgetController['onAdd'])==='function'){widgetController.onAdd($newWidget);}}
if(callback){callback($newWidget.data('widgetinstanceid'));}},dataType:'json'});};this.moveWidget=function(instanceId,position,block,revisionId,callback){var data=Object();data.aa='Content.moveWidget';data.securityToken=ip.securityToken;data.instanceId=instanceId;data.position=position;data.blockName=block;data.revisionId=revisionId;var $originalBlock=$('#ipWidget-'+instanceId).closest('.ipBlock');$.ajax({type:'POST',url:ip.baseUrl,data:data,success:function(response){if(response.status=='error'){alert(response.errorMessage);}
var $block=$('#ipBlock-'+response.block);var $widget=$('#ipWidget-'+response.oldInstance);var $newWidget=$(response.widgetHtml);$widget.replaceWith($newWidget);$newWidget.detach();if(position==0){$block.prepend($newWidget);}else{$newWidget.insertAfter($block.find(' > .ipWidget').eq(position-1));}
$block.trigger('reinitRequired.ipWidget');$block.find(' > .ipbExampleContent').remove();$block.removeClass('ipbEmpty');if($originalBlock.children('.ipWidget').length==0){$originalBlock.addClass('ipbEmpty');}
var $columnsWidget=$originalBlock.closest('.ipWidget-Columns');if($columnsWidget.length){deleteEmptyColumns($columnsWidget.data('widgetinstanceid'),function(){if(callback){callback(response.newInstanceId);}
return;});}
if(callback){callback(response.newInstanceId);}},dataType:'json'});};};})(ip.jQuery);(function($){$.support.touch='ontouchend'in document;if(!$.support.touch){return;}
var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return;}
event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent('MouseEvents');simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent);}
mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return;}
touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,'mouseover');simulateMouseEvent(event,'mousemove');simulateMouseEvent(event,'mousedown');};mouseProto._touchMove=function(event){if(!touchHandled){return;}
this._touchMoved=true;simulateMouseEvent(event,'mousemove');};mouseProto._touchEnd=function(event){if(!touchHandled){return;}
simulateMouseEvent(event,'mouseup');simulateMouseEvent(event,'mouseout');if(!this._touchMoved){simulateMouseEvent(event,'click');}
touchHandled=false;};mouseProto._mouseInit=function(){var self=this;self.element.bind('touchstart',$.proxy(self,'_touchStart')).bind('touchmove',$.proxy(self,'_touchMove')).bind('touchend',$.proxy(self,'_touchEnd'));_mouseInit.call(self);};})(ip.jQuery);(function($){"use strict";$(document).bind('initFinished.ipContentManagement',function(){$('.ipActionWidgetButton').bind('dragstart',function(event,ui){$('.ipBlock > .ipbExampleContent').each(function(){var $ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.css('min-height')){$block.data('ipMinHeight',$block.css('min-height'));}
$block.css('min-height',$block.height());$ipExampleContent.fadeOut('slow');});}).bind('dragstop',function(event,ui){$('.ipBlock > .ipbExampleContent').each(function(){var $ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.children('.ipAdminWidgetPlaceholder').length){$ipExampleContent.remove();}else{$ipExampleContent.fadeIn('fast');}
if(!$block.data('ipMinHeight')){$block.css('min-height','');}else{$block.css('min-height',$block.data('ipMinHeight'));$block.removeData('ipMinHeight');}});});});})(ip.jQuery);(function($){"use strict";$(document).ready(function(){$(document).ipContentManagement();var $emptyDiv=$('<div contenteditable="true" style="display: none"></div>');$("body").append($emptyDiv);$emptyDiv.tinymce(ipTinyMceConfig());setTimeout(function(){$emptyDiv.remove()},'10000');});})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipBlock');if(!data){$this.delegate('.ipsWidgetDrag','click',function(e){e.preventDefault();});initWidgetDrag($this);$this.data('ipBlock',{name:$this.attr('id').substr(8),revisionId:$this.data('revisionid'),widgetControlsHtml:options.widgetControlsHtml});var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data('ipBlock').widgetControlsHtml;$this.children('.ipWidget').ipWidget(widgetOptions);$this.bind('reinitRequired.ipWidget',function(event){if($(event.target).closest('.ipBlock')[0]!=$this[0]){return;}
$(this).ipBlock('reinit');});$this.on('click','> .ipbExampleContent',function(){var $block=$this;var $exampleContent=$(this);ipContent.createWidget(ip.revisionId,$block.data('ipBlock').name,'Text',0);$exampleContent.remove();});}});},reinit:function(){return this.each(function(){var $this=$(this);var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data('ipBlock').widgetControlsHtml;$(this).children('.ipWidget').ipWidget(widgetOptions);initWidgetDrag($this);});},destroy:function(){}};var initWidgetDrag=function($block){console.log('init');var $this=$block;$this.find('.ipWidget').not('.ipWidget-Columns').draggable({handle:'.ipsWidgetControls .ipsWidgetDrag',cursorAt:{left:30,top:30},cancel:false,helper:function(e){return'<div class="ipAdminWidgetDragIcon"></div>';},start:function(event,ui){$(event.target).css('visibility','hidden');},stop:function(event,ui){$(event.target).css('visibility','');},revert:function(droppable){if(droppable===false){$this.trigger('unsuccessfulDrop.ipWidget',{widgetButton:$this});return true;}else{$this.trigger('successfulDrop.ipWidget',{widgetButton:$this,block:droppable});return false;}}});}
$.fn.ipBlock=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipAdminWidgetButton');}};})(ip.jQuery);(function($){"use strict";var lastDroppable=false;var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipContentManagement');if(!data){$this.data('ipContentManagement',{});$(window).resize(function(){if(this.resizeTO){clearTimeout(this.resizeTO);}
this.resizeTO=setTimeout(function(){$(this).trigger('resizeEnd');},100);});$(window).bind('resizeEnd',ipAdminWidgetsScroll);ip.jQuery.expr[':'].icontains=function(a,i,m){return ip.jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0;};if(isMobile){$('body').addClass('ipMobile');}
$('body').prepend(ipContentInit.saveProgressHtml);$('body').prepend(ipContentInit.controlPanelHtml);var options=new Object;options.zoneName=ip.zoneName;options.pageId=ip.pageId;options.revisionId=ip.revisionId;options.widgetControlsHtml=ipContentInit.widgetControlsHtml;options.contentManagementObject=$this;options.manageableRevision=ipContentInit.manageableRevision;var data=$this.data('ipContentManagement');data.initInfo=options;$this.data('ipContentManagement',data);$('.ipAdminPanel .ipActionWidgetButton').ipAdminWidgetButton();ipAdminPanelInit();ipAdminWidgetsScroll();ipAdminWidgetsSearch();$('.ipAdminPanel .ipActionWidgetButton').on('dragstart',ipStartWidgetDrag);$('.ipAdminPanel .ipActionWidgetButton').on('dragstop',ipStopWidgetDrag);$('.ipBlock .ipWidget').on('dragstart.ipContentManagement',ipStartWidgetDrag);$('.ipBlock .ipWidget').on('dragstop.ipContentManagement',ipStopWidgetDrag);$('body').on('reinitRequired.ipWidget',function(){$('.ipBlock .ipWidget').off('dragstart.ipContentManagement').on('dragstart.ipContentManagement',ipStartWidgetDrag);$('.ipBlock .ipWidget').off('dragstop.ipContentManagement').on('dragstop.ipContentManagement',ipStopWidgetDrag);})
$('.ipAdminPanel .ipActionSave').on('click',function(e){$.proxy(methods.save,$this)(false)});$('.ipAdminPanel .ipActionPublish').on('click',function(e){$.proxy(methods.save,$this)(true)});$('.ipAdminPanelContainer .ipsPreview').on('click',function(e){e.preventDefault();ipManagementMode.setManagementMode(0);});$this.on('error.ipContentManagement',function(event,error){$(this).ipContentManagement('addError',error);});$.proxy(methods.initBlocks,$this)($('.ipBlock'));$this.trigger('initFinished.ipContentManagement',options);}});},initBlocks:function(blocks){var $this=this;var data=$this.data('ipContentManagement');var options=data.initInfo;if(options.manageableRevision){blocks.ipBlock(options);}},addError:function(errorMessage){var $newError=$('.ipAdminErrorSample .ipAdminError').clone();$newError.text(errorMessage);$('.ipAdminErrorContainer').append($newError);$newError.animate({opacity:"100%"},6000).animate({queue:true,opacity:"0%"},{duration:3000,complete:function(){$(this).remove();}});},save:function(publish){return this.each(function(){var $this=$(this);var data=$this.data('ipContentManagement');var postData=Object();postData.aa='Content.savePage';postData.securityToken=ip.securityToken;postData.revisionId=ip.revisionId;if(publish){postData.publish=1;}else{postData.publish=0;}
$.ajax({type:'POST',url:ip.baseUrl,data:postData,context:$this,success:methods._savePageResponse,dataType:'json'});});},_savePageResponse:function(response){var $this=$(this);var data=$this.data('ipContentManagement');if(response.status=='success'){window.location.href=response.newRevisionUrl;}else{}}};var ipAdminWidgetsScroll=function(){var $scrollable=$('.ipAdminWidgetsContainer');$scrollable.scrollable({items:'li',touch:false});var scrollableAPI=$scrollable.data('scrollable');var itemWidth=scrollableAPI.getItems().eq(0).outerWidth(true);var containerWidth=scrollableAPI.getRoot().width()+24;var scrollBy=Math.floor(containerWidth/itemWidth);if(scrollBy<1){scrollBy=1;}
$('.ipAdminWidgets .ipsRight, .ipAdminWidgets .ipsLeft').off('click');scrollableAPI.begin();$('.ipAdminWidgets .ipsRight').on('click',function(event){event.preventDefault();scrollableAPI.move(scrollBy);});$('.ipAdminWidgets .ipsLeft').on('click',function(event){event.preventDefault();scrollableAPI.move(-scrollBy);});}
var ipAdminWidgetsSearch=function(){var $input=$('.ipAdminWidgetsSearch .ipsInput');var $button=$('.ipAdminWidgetsSearch .ipsButton');var $widgets=$('.ipAdminWidgetsContainer li');$input.focus(function(){if(this.value==this.defaultValue){this.value='';};}).blur(function(){if(this.value==''){this.value=this.defaultValue;};}).keyup(function(){var value=this.value;$widgets.css('display','');if(value&&value!=this.defaultValue){$widgets.not(':icontains('+value+')').css('display','none');$button.addClass('ipaClear');}else{$button.removeClass('ipaClear');}
ipAdminWidgetsScroll();});$button.click(function(event){event.preventDefault();var $this=$(this);if($this.hasClass('ipaClear')){$input.val('').blur().keyup();$this.removeClass('ipaClear');}});}
var ipAdminPanelInit=function(){var $container=$('.ipAdminPanelContainer');var $panel=$('.ipAdminPanel');$container.height($panel.height());$panel.css('top',$('.ipsAdminNavbarContainer').outerHeight());}
var ipStartWidgetDrag=function(event,ui){var draggingElement=ui.item;var sidePlaceholders=new Array();$('.ipBlock > .ipWidget').not(".ipWidget .ipWidget").not(draggingElement).each(function(key,value){sidePlaceholders.push({left:$(value).offset().left-20,top:$(value).offset().top+1,height:Math.max($(value).height()-2,10),width:20,instanceId:$(value).data('widgetinstanceid'),leftOrRight:'left'});sidePlaceholders.push({left:$(value).offset().left+$(value).width(),top:$(value).offset().top+1,height:Math.max($(value).height()-2,10),width:20,instanceId:$(value).data('widgetinstanceid'),leftOrRight:'right'});});$.each(sidePlaceholders,function(key,value){var $droppable=$('<div class="ipsWidgetDropPlaceholder ipAdminWidgetPlaceholderVertical"><div class="ipsWidgetDropMarker _marker"></div></div>');$('body').append($droppable);$droppable.css('position','absolute');$droppable.css('left',value.left+'px');$droppable.css('top',value.top+'px');$droppable.css('height',value.height+'px');$droppable.css('width',value.width+'px');$droppable.data('instanceId',value.instanceId);$droppable.data('leftOrRight',value.leftOrRight);$droppable.data('side',1);$droppable.find('.ipsWidgetDropMarker').height(value.height);$droppable.find('.ipsWidgetDropMarker').css('marginLeft',Math.round(value.width/2));});var colsPlaceholders=new Array();$.each($('.ipWidget-Columns'),function(widgetKey,columnsWidget){$.each($(columnsWidget).find('.ipsCol'),function(colKey,col){var $col=$(col);var $prevBlock=$col.prev().find('.ipBlock');var $block=$col.find('.ipBlock');if(colKey!=0&&$block.offset()&&$prevBlock.offset()){var space=$block.offset().left-($prevBlock.offset().left+$prevBlock.width());colsPlaceholders.push({left:$col.find('.ipBlock').offset().left-space,top:$col.find('.ipBlock').offset().top+1,height:Math.max($(columnsWidget).height()-2,10),width:space,instanceId:$(columnsWidget).data('widgetinstanceid'),position:colKey});}});});$.each(colsPlaceholders,function(key,value){var $droppable=$('<div class="ipsWidgetDropPlaceholder ipAdminWidgetPlaceholderVertical"><div class="ipsWidgetDropMarker _marker"></div></div>');$('body').append($droppable);$droppable.css('position','absolute');$droppable.css('left',value.left+'px');$droppable.css('top',value.top+'px');$droppable.css('height',value.height+'px');$droppable.css('width',value.width+'px');$droppable.data('instanceId',value.instanceId);$droppable.data('newCol',1);$droppable.data('position',value.position);$droppable.find('.ipsWidgetDropMarker').height(value.height);$droppable.find('.ipsWidgetDropMarker').css('marginLeft',Math.round(value.width/2));});var horizontalPlaceholders=new Array();$.each($('.ipBlock'),function(blockKey,block){var $widgets=$(block).find('> .ipWidget');$.each($widgets,function(key,value){var $widget=$(value);if($widget.index()==0){var space=15;var newPlaceholder={left:$widget.offset().left,top:$widget.offset().top-space,width:$widget.width(),blockName:$(block).data('ipBlock').name,position:0,markerOffset:space/2};newPlaceholder.height=$widget.offset().top+($widget.height()/2)-newPlaceholder.top;if($widget.hasClass("ipWidget-Columns")){newPlaceholder.height=space*3/4;newPlaceholder.markerOffset=space*3/4/2;}
if($widget.closest('.ipWidget-Columns').length&&!$widget.hasClass("ipWidget-Columns")){var $aboveColumnsWidget=$widget.closest('.ipWidget-Columns').prev();if($aboveColumnsWidget.length){space=$widget.offset().top-($aboveColumnsWidget.offset().top+$aboveColumnsWidget.height());newPlaceholder.top=$widget.offset().top-space/2;newPlaceholder.markerOffset=space/2/2;}else{newPlaceholder.top=$widget.offset().top-space*1/4;newPlaceholder.markerOffset=space*1/4/2;}
newPlaceholder.height=$widget.offset().top+($widget.height()/2)-newPlaceholder.top;}
horizontalPlaceholders.push(newPlaceholder);}else{var $prevWidget=$widget.prev();var space=$widget.offset().top-($prevWidget.offset().top+$prevWidget.height());var newPlaceholder={left:$prevWidget.offset().left,top:$prevWidget.offset().top+($prevWidget.height()/2),width:$widget.width(),blockName:$(block).data('ipBlock').name,position:$widget.index()};if($prevWidget.hasClass("ipWidget-Columns")){newPlaceholder.top=$prevWidget.offset().top+$prevWidget.height()+space*1/4;}
newPlaceholder.height=$widget.offset().top+($widget.height()/2)-newPlaceholder.top;if($widget.hasClass('ipWidget-Columns')){newPlaceholder.height=$widget.offset().top-newPlaceholder.top-(space/2);newPlaceholder.markerOffset=newPlaceholder.height-1;}
newPlaceholder.markerOffset=($prevWidget.offset().top+$prevWidget.height()+$widget.offset().top)/2-newPlaceholder.top;horizontalPlaceholders.push(newPlaceholder);}
if($widget.index()==$widgets.length-1){var space=10;var newPlaceholder={left:$widget.offset().left,top:$widget.offset().top+$widget.height()/2,height:$widget.height()/2+space,width:$widget.width(),markerOffset:$widget.height()/2+space/2,blockName:$(block).data('ipBlock').name,position:$widget.index()+1};var $columnsWidget=$widget.closest('.ipWidget-Columns');if($columnsWidget.length&&!$widget.hasClass("ipWidget-Columns")){var columnsEnd=$columnsWidget.offset().top+$columnsWidget.height();if($columnsWidget.next().length){space=$columnsWidget.next().offset().top-columnsEnd;}
newPlaceholder.height=columnsEnd-newPlaceholder.top+space*1/4;}
if($widget.hasClass('ipWidget-Columns')){var columnsEnd=$columnsWidget.offset().top+$columnsWidget.height();newPlaceholder.height=space*2;newPlaceholder.top=columnsEnd+space*1/4;newPlaceholder.markerOffset=5;}
horizontalPlaceholders.push(newPlaceholder);}});if($(block).find('> .ipWidget').length==0){var $block=$(block);horizontalPlaceholders.push({left:$block.offset().left,top:$block.offset().top,height:$block.height(),width:$block.width(),markerOffset:$block.height()/2,blockName:$block.data('ipBlock').name,position:0});}});$.each(horizontalPlaceholders,function(key,value){var $droppable=$('<div class="ipsWidgetDropPlaceholder ipAdminWidgetPlaceholderHorizontal"><div class="ipsWidgetDropMarker _marker"></div></div>');$('body').append($droppable);$droppable.css('position','absolute');$droppable.css('left',value.left+'px');$droppable.css('top',value.top+'px');$droppable.css('width',value.width+'px');$droppable.css('height',value.height+'px');$droppable.find('.ipsWidgetDropMarker').css('marginTop',value.markerOffset);$droppable.data('position',value.position);$droppable.data('blockName',value.blockName);});$('.ipsWidgetDropPlaceholder').droppable({accept:".ipActionWidgetButton, .ipWidget",activeClass:"",hoverClass:"hover",greedy:true,over:function(event,ui){lastDroppable=$(this);$(this).data('hover',true);},out:function(event,ui){$(this).data('hover',false);},drop:function(event,ui){}});}
var ipStopWidgetDrag=function(event,ui){if(lastDroppable&&lastDroppable.data('hover')&&$(event.target).data('ipAdminWidgetButton')){var targetWidgetInstanceId=lastDroppable.data('instanceId');var leftOrRight=lastDroppable.data('leftOrRight');var widgetName=$(this).data('ipAdminWidgetButton').name;var side=lastDroppable.data('side');var newCol=lastDroppable.data('newCol');var blockName=lastDroppable.data('blockName');var position=lastDroppable.data('position');if(side){ipContent.createWidgetToSide(widgetName,targetWidgetInstanceId,leftOrRight);}else if(newCol){ipContent.createWidgetToColumn(widgetName,targetWidgetInstanceId,position);}else{ipContent.createWidget(ip.revisionId,blockName,widgetName,position);}}
if(lastDroppable&&lastDroppable.data('hover')&&$(event.target).hasClass('ipWidget')){var $widget=$(event.target);var instanceId=$widget.data('widgetinstanceid');var curPosition=$widget.index();var curBlock=$widget.closest('.ipBlock').data('ipBlock').name;var position=lastDroppable.data('position');var block=lastDroppable.data('blockName');var side=lastDroppable.data('side');var newCol=lastDroppable.data('newCol');var leftOrRight=lastDroppable.data('leftOrRight');var targetWidgetInstanceId=lastDroppable.data('instanceId');var sourceWidgetInstanceId=$widget.data('widgetinstanceid');if(block==curBlock&&curPosition<position){position--;}
if(block!=curBlock||curPosition!=position){if(side){ipContent.moveWidgetToSide(sourceWidgetInstanceId,targetWidgetInstanceId,leftOrRight);}else if(newCol){ipContent.moveWidgetToColumn(sourceWidgetInstanceId,targetWidgetInstanceId,position);}else{ipContent.moveWidget(instanceId,position,block,ip.revisionId);}}}
$('.ipsWidgetDropPlaceholder').remove();}
$.fn.ipContentManagement=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipAdminWidgetButton');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var $list=$this.find('.ipsList');$list.html('');var $itemTemplate=$this.find('.ipsItemTemplate');$.each(options.layouts,function(key,value){var $newItem=$itemTemplate.clone().detach().text(value.title).data('layout',value.name);if(value.name==options.currentLayout){$newItem.addClass('active');$newItem.on('click',function(e){e.preventDefault();$this.modal('hide');})}else{$newItem.on('click',function(e){e.preventDefault();options.widgetObject.ipWidget('changeSkin',value.name);$this.modal('hide');})}
$list.append($newItem);});$this.modal();});}}
$.fn.ipLayoutModal=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on ipLayoutModal');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);$this.prepend(options.widgetControlls);$this.save=function(data,refresh,callback){$(this).ipWidget('save',data,refresh,callback);};var data=$this.data('ipWidgetInit');if(!data){$this.data('ipWidgetInit',Object());var widgetName=$this.data('widgetname');var data=$this.data('widgetdata');var functionClass='IpWidget_'+widgetName;if(typeof(window[functionClass])=='function'){var widgetController;widgetController=new window[functionClass];if(widgetController.init){widgetController.init($this,data);}
$this.data('widgetController',widgetController);}}
$this.find(' > .ip > .ipsWidgetControls .ipsWidgetDelete').on('click',function(e){e.preventDefault();ipContent.deleteWidget($this.data('widgetinstanceid'));});$this.find('.ipsSkin').on('click',$.proxy(openLayoutModal,this));});},widgetController:function(){return this.data('widgetController');},save:function(widgetData,refresh,callback){return this.each(function(){var $this=$(this);var $queue=$this.data('saveQueue');if($queue==null){$queue=[];}
$queue.push({widgetData:widgetData,refresh:refresh,callback:callback});$this.data('saveQueue',$queue);if($this.data('saveInProgress')){return;}else{$.proxy(processSaveQueue,$this)();}});},changeSkin:function(skin){return this.each(function(){var $this=$(this);var data=Object();data.aa='Content.changeSkin';data.securityToken=ip.securityToken;data.instanceId=$this.data('widgetinstanceid');data.skin=skin;$.ajax({type:'POST',url:ip.baseUrl,data:data,context:$this,success:function(response){var $newWidget=$(response.html);$($newWidget).insertAfter($this);$newWidget.trigger('reinitRequired.ipWidget');$(document).ipContentManagement('initBlocks',$newWidget.find('.ipBlock'));$this.remove();},error:function(response){console.log(response);},dataType:'json'});});}};var processSaveQueue=function(){var $this=this;var $widget=$this;if($this.data('saveInProgress')){return;}else{$this.data('saveInProgress',true);}
var $queue=$this.data('saveQueue');$this.data('saveQueue',[]);if($queue==null||$queue.length==0){$this.data('saveInProgress',false);return;}
var refresh=false;var callbacks=[];$.each($queue,function(key,value){if(value.refresh){refresh=true;}
if(value.callback){callbacks.push(value.callback);}});ipContent.updateWidget($this.data('widgetinstanceid'),$queue[$queue.length-1].widgetData,refresh,function(newInstanceId){var $this=$widget;var $newWidget=$('#ipWidget-'+newInstanceId);if(callbacks.length){if(refresh){$.each(callbacks,function(key,value){value($newWidget);});}else{$.each(callbacks,function(key,value){value($newWidget);});}}
$this.data('saveInProgress',false);$.proxy(processSaveQueue,$this)();});}
var openLayoutModal=function(e){e.preventDefault();var $this=$(this);var $layoutButton=$this.find('.ipsSkin');var layouts=$layoutButton.data('layouts');var currentLayout=$layoutButton.data('currentlayout');var $modal=$('#ipWidgetLayoutPopup');$modal.ipLayoutModal({layouts:layouts,currentLayout:currentLayout,widgetObject:$this})}
$.fn.ipWidget=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipWidget');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipAdminWidgetButton');if(!data){$this.draggable({revert:function(droppable){if(droppable===false){$this.trigger('unsuccessfulDrop.ipWidgetButton',{widgetButton:$this});return true;}else{$this.trigger('successfulDrop.ipWidgetButton',{widgetButton:$this,block:droppable});return false;}},helper:function(e){var $button=$(e.currentTarget);var $result=$button.clone();$result.find('span').remove();$result.css('padding-top','15px');return $result;},opacity:0.45,cursorAt:{left:30,top:45},stop:function(event,ui){},start:function(event,ui){$(this).data("startingScrollTop",$('body').scrollTop());},drag:function(event,ui){var start=parseInt($(this).data("startingScrollTop"));ui.position.top-=$('body').scrollTop()-start;}});$this.data('ipAdminWidgetButton',{name:$this.attr('id').substr(20)});}
$this.find('a').bind('click',function(){return false;});});},destroy:function(){}};$.fn.ipAdminWidgetButton=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipAdminWidgetButton');}};})(ip.jQuery);var IpWidget_Columns;(function($){"use strict";IpWidget_Columns=function(widgetObject){this.widgetObject=widgetObject;this.manageInit=manageInit;this.prepareData=prepareData;function manageInit(){var instanceData=this.widgetObject.data('ipWidget').data;if(instanceData.baseId){this.widgetObject.find('input[name="baseId"]').val(instanceData.baseId);}else{}}
function prepareData(){var data={};data.baseId=this.widgetObject.find('input[name="baseId"]').val();data.columns=this.widgetObject.find('input[name="columns"]').val();$(this.widgetObject).trigger('preparedWidgetData.ipWidget',[data]);}}})(ip.jQuery);var IpWidget_Faq;(function($){"use strict";IpWidget_Faq=function(widgetObject){this.widgetObject=widgetObject;this.manageInit=manageInit;this.prepareData=prepareData;function manageInit(){var instanceData=this.widgetObject.data('ipWidget');this.widgetObject.find('textarea').tinymce(ipTinyMceConfig());}
function prepareData(){var data=Object();data.answer=this.widgetObject.find('.ipAdminTextarea').html();data.question=this.widgetObject.find('.ipAdminInput').val();$(this.widgetObject).trigger('preparedWidgetData.ipWidget',[data]);}};})(ip.jQuery);var IpWidget_File;(function($){IpWidget_File=function(){this.widgetObject=null;this.filesSelected=null;this.init=function($widgetObject,data){this.data=data;this.widgetObject=$widgetObject;var $widgetOverlay=$('<div></div>').css('position','absolute').css('z-index',5).width(this.widgetObject.width()).height(this.widgetObject.height());this.widgetObject.prepend($widgetOverlay);$widgetOverlay.on('click',$.proxy(openPopup,this));};this.onAdd=function(e){$.proxy(openPopup,this)();this.modal.find('.ipmBrowseButton').click();};var openPopup=function(){this.modal=$('#ipWidgetFilePopup');this.addButton=this.modal.find(".ipsFieldAdd");this.container=this.modal.find('.ipWidget_ipForm_container');this.confirmButton=this.modal.find('.ipsConfirm');this.modal.modal();var context=this;var uploader=this.modal.find('.ipsUpload');var options=new Object;uploader.ipUploadFile(options);var container=this.modal.find('.ipWidget_ipFile_container');var options=new Object;if(this.data.files){options.files=this.data.files;}else{options.files=new Array();}
options.fileTemplate=this.modal.find('.ipsFileTemplate');container.ipWidget_ipFile_container('destroy');container.ipWidget_ipFile_container(options);this.confirmButton.off().on('click',$.proxy(save,this));this.modal.off('filesSelected.ipUploadFile').on('filesSelected.ipUploadFile',this.filesSelected);var widgetObject=this.widgetObject;this.modal.find('.ipmBrowseButton').click(function(e){e.preventDefault();var repository=new ipRepository({preview:'list'});repository.bind('ipRepository.filesSelected',$.proxy(fileUploaded,context));});};var fileUploaded=function(event,files){var container=this.modal.find('.ipWidget_ipFile_container');for(var index in files){container.ipWidget_ipFile_container('addFile',files[index].fileName,files[index].fileName,'new');}}
var save=function(){var data=Object();var container=this.modal.find('.ipWidget_ipFile_container');data.files=new Array();var $files=container.ipWidget_ipFile_container('getFiles');var notDeletedCount=0;$files.each(function(index){var $this=$(this);var tmpFile=new Object();tmpFile.title=$this.ipWidget_ipFile_file('getTitle');tmpFile.fileName=$this.ipWidget_ipFile_file('getFileName');tmpFile.status=$this.ipWidget_ipFile_file('getStatus');data.files.push(tmpFile);if(tmpFile.status!='deleted'){notDeletedCount++;}});if(notDeletedCount==0){this.modal.modal('hide');ipContent.deleteWidget(this.widgetObject.data('widgetinstanceid'));return;}
this.widgetObject.save(data,true);this.modal.modal('hide');}};})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipWidget_ipFile_file');if(!data){var data={title:'',fileName:'',status:'new'};if(options.title){data.title=options.title;}
if(options.fileName){data.fileName=options.fileName;}
if(options.status){data.status=options.status;}
$this.data('ipWidget_ipFile_file',{title:data.title,fileName:data.fileName,status:data.status});$this.find('.ipsFileTitle').val(data.title);}
$this.find('.ipsFileLink').attr('href',ipFileUrl('file/repository/'+data.fileName));$this.find('.ipsFileRemove').bind('click',function(event){event.preventDefault();$this=$(this);$this.trigger('removeClick.ipWidget_ipFile');});$this.bind('removeClick.ipWidget_ipFile',function(event){$this.trigger('removeFile.ipWidget_ipFile',this);});return $this;});},getTitle:function(){var $this=this;return $this.find('.ipsFileTitle').val();},getFileName:function(){var $this=this;var tmpData=$this.data('ipWidget_ipFile_file');return tmpData.fileName;},getStatus:function(){var $this=this;var tmpData=$this.data('ipWidget_ipFile_file');return tmpData.status;},setStatus:function(newStatus){var $this=$(this);var tmpData=$this.data('ipWidget_ipFile_file');tmpData.status=newStatus;$this.data('ipWidget_ipFile_file',tmpData);}};$.fn.ipWidget_ipFile_file=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipAdminWidgetButton');}};})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipWidget_ipFile_container');var files=null;if(options.files){files=options.files;}else{files=new Array();}
if(!data){$this.data('ipWidget_ipFile_container',{files:files,fileTemplate:options.fileTemplate});for(var i in files){$this.ipWidget_ipFile_container('addFile',files[i]['fileName'],files[i]['title'],'present');}
$this.bind('removeFile.ipWidget_ipFile',function(event,fileObject){var $fileObject=$(fileObject);$fileObject.ipWidget_ipFile_container('removeFile',$fileObject);});$(".ipWidget_ipFile_container").sortable();$(".ipWidget_ipFile_container").sortable('option','handle','.ipsFileMove');}});},addFile:function(fileName,title,status){var $this=this;var $newFileRecord=$this.data('ipWidget_ipFile_container').fileTemplate.clone().removeClass('ipsFileTemplate').addClass('ipsFile');$newFileRecord.ipWidget_ipFile_file({'status':status,'fileName':fileName,'title':title});$this.append($newFileRecord);},removeFile:function($fileObject){$fileObject.hide();$fileObject.ipWidget_ipFile_file('setStatus','deleted');},getFiles:function(){var $this=this;return $this.find('.ipsFile');},destroy:function(){return this.each(function(){var $this=$(this);$this.html('');$.removeData(this,'ipWidget_ipFile_container');});}};$.fn.ipWidget_ipFile_container=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipAdminWidgetButton');}};})(ip.jQuery);var IpWidget_Form;(function($){"use strict";IpWidget_Form=function(){this.data=null;this.modal=null;this.container=null;this.addButton=null;this.confirmButton=null;this.init=function($widgetObject,data){this.data=data;this.widgetObject=$widgetObject;var $widgetOverlay=$('<div></div>').css('position','absolute').css('z-index',5).width(this.widgetObject.width()).height(this.widgetObject.height());this.widgetObject.prepend($widgetOverlay);$widgetOverlay.on('click',$.proxy(openPopup,this));};var openPopup=function(){this.modal=$('#ipWidgetFormPopup');this.addButton=this.modal.find(".ipsFieldAdd");this.container=this.modal.find('.ipWidget_ipForm_container');this.confirmButton=this.modal.find('.ipsConfirm');this.modal.modal();this.modal.on('hidden.bs.modal',$.proxy(cleanup,this));this.confirmButton.on('click',$.proxy(save,this));var instanceData=this.data;var options=new Object;if(instanceData['fields']){options.fields=instanceData.fields;}else{options.fields=new Array();}
options.fieldTemplate=this.modal.find('.ipsFieldTemplate');options.optionsPopup=$("#ipWidgetFormPopupOptions").ipWidget_ipForm_options({fieldTypes:instanceData.fieldTypes});this.container.ipWidget_ipForm_container('destroy');this.container.ipWidget_ipForm_container(options);this.addButton.on('click',$.proxy(addField,this));var customTinyMceConfig=ipTinyMceConfig();this.modal.find('.ipsSuccess').html(instanceData.success);this.modal.find('.ipsSuccess').tinymce(customTinyMceConfig);if(instanceData.sendTo=='custom'){this.modal.find('input[value=custom]').prop('checked',true);}else{this.modal.find('input[value=default]').prop('checked',true);}
this.modal.find('input[name=emails]').val(instanceData.emails);};var cleanup=function(){this.container.html('');this.container.ipWidget_ipForm_container('destroy');this.addButton.off();this.confirmButton.off();}
var addField=function(e){this.container.ipWidget_ipForm_container('addField');};var save=function(e){var data=this.getData();this.widgetObject.save(data,1);this.modal.modal('hide');};this.getData=function(){var data=Object();data.fields=new Array();var $fields=this.container.ipWidget_ipForm_container('getFields');$fields.each(function(index){var $this=$(this);var tmpField=new Object();tmpField.label=$this.ipWidget_ipForm_field('getLabel');tmpField.type=$this.ipWidget_ipForm_field('getType');tmpField.options=$this.ipWidget_ipForm_field('getOptions');if($this.ipWidget_ipForm_field('getRequired')){tmpField.required=1;}else{tmpField.required=0;}
var status=$this.ipWidget_ipForm_field('getStatus');if(status!='deleted'){data.fields.push(tmpField);}});data.success=this.modal.find('.ipsSuccess').html();if(this.modal.find('input[value=custom]').prop('checked')){data.sendTo='custom';}else{data.sendTo='default';}
data.emails=this.modal.find('input[name=emails]').val();return data;};};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data('ipWidget_ipForm_container');var fields=null;if(options.fields){fields=options.fields;}else{fields=new Array();}
if(!data){$this.html('');$this.data('ipWidget_ipForm_container',{fields:fields,fieldTemplate:options.fieldTemplate,optionsPopup:options.optionsPopup});if(!fields instanceof Array){fields=new Array();}
for(var i in fields){$this.ipWidget_ipForm_container('addField',fields[i]);}
$this.sortable();$this.sortable('option','handle','.ipsFieldMove');}});},addField:function(fieldData){var $this=this;if(typeof fieldData!=='object'){fieldData={};}
var data=fieldData;data.optionsPopup=$this.data('ipWidget_ipForm_container').optionsPopup;var $newFieldRecord=$this.data('ipWidget_ipForm_container').fieldTemplate.clone();$newFieldRecord.ipWidget_ipForm_field(data);$this.append($newFieldRecord);},getFields:function(){var $this=this;return $this.find('.ipsFieldTemplate');},destroy:function(){return this.each(function(){$.removeData(this,'ipWidget_ipForm_container');});}};$.fn.ipWidget_ipForm_container=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipWidget_ipForm_container');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){if(typeof options!=='object'){options={};}
return this.each(function(){var $this=$(this);var data=$this.data('ipWidget_ipForm_field');if(!data){var data={label:'',type:'Text',required:false,status:'new',options:{}};if(options.label){data.label=options.label;}
if(options.type){data.type=options.type;}
if(options.required&&options.required!='0'&&options.required!='false'){data.required=true;}else{data.required=false;}
if(options.status){data.status=options.status;}
$this.data('ipWidget_ipForm_field',{label:data.label,type:data.type,required:data.required,status:data.status,optionsPopup:options.optionsPopup});$this.find('.ipsFieldLabel').val(data.label);$this.find('.ipsFieldType').val(data.type);$this.find('.ipsFieldType').on('change',function(e){$.proxy(setFieldType,$this)($(this).val());});$.proxy(setFieldType,$this)(data.type);if(options.options){$.proxy(setOptions,$this)(options.options);}
if(options.required&&options.required!=0){$this.find('.ipsFieldRequired').prop('checked',options.required);}}
var $thisForEvent=$this;$this.find('.ipsFieldRemove').bind('click',function(event){$thisForEvent.ipWidget_ipForm_field('setStatus','deleted');$thisForEvent.hide();event.preventDefault();});return $this;});},getOptions:function(){var $this=$(this);var data=$this.data('ipWidget_ipForm_field');if(data.options&&data.options[$this.ipWidget_ipForm_field('getType')]){return data.options[$this.ipWidget_ipForm_field('getType')];}else{return null;}},getLabel:function(){var $this=this;return $this.find('.ipsFieldLabel').val();},getType:function(){var $this=this;return $this.find('.ipsFieldType').val();},getStatus:function(){var $this=this;var tmpData=$this.data('ipWidget_ipForm_field');return tmpData.status;},setStatus:function(newStatus){var $this=this;var tmpData=$this.data('ipWidget_ipForm_field');tmpData.status=newStatus;$this.data('ipWidget_ipForm_field',tmpData);},getRequired:function(){var $this=$(this);return $this.find('.ipsFieldRequired').is(':checked');}};var openOptionsPopup=function(){var $this=$(this);var data=$this.data('ipWidget_ipForm_field');var $fieldContext=$this;data.optionsPopup.bind('saveOptions.ipWidget_ipForm',function(e,options){$this=$(this);$this.unbind('saveOptions.ipWidget_ipForm');$.proxy(setOptions,$fieldContext)(options);});data.optionsPopup.ipWidget_ipForm_options('showOptions',data.type,$this.ipWidget_ipForm_field('getOptions'));};var setFieldType=function(type){var $this=this;var data=$this.data('ipWidget_ipForm_field');if(data.optionsPopup.ipWidget_ipForm_options('optionsAvailable',type)){$this.find('.ipsFieldOptions').css('visibility','visible');$this.find('.ipsFieldOptions').on('click',$.proxy(openOptionsPopup,this));}else{$this.find('.ipsFieldOptions').css('visibility','hidden');}
data.type=type;$this.data('ipWidget_ipForm_field',data);};var setOptions=function(options){var $this=this;var data=$this.data('ipWidget_ipForm_field');if(!data.options){data.options={};}
data.options[$this.ipWidget_ipForm_field('getType')]=options;$this.data('ipWidget_ipForm_field',data);};$.fn.ipWidget_ipForm_field=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipWidget_ipForm_field');}};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){if(!options){options={};}
return this.each(function(){var $this=$(this);var data=$this.data('ipWidget_ipForm_options');if(!data){var data={fieldTypes:options.fieldTypes};$this.data('ipWidget_ipForm_options',data);}
return $this;});},showOptions:function(fieldType,currentOptions){var $this=this;var $optionsModal=$this;var fieldType=$this.ipWidget_ipForm_options('getFieldType',fieldType);$this.find('.modal-body').html(fieldType.optionsHtml);var $confirm=$this.find('.ipsConfirm');$('#ipWidgetFormPopup').hide();$confirm.off().on('click',function(){var options=window[fieldType.optionsSaveFunction]($optionsModal);$('#ipWidgetFormPopup').show();$optionsModal.modal("hide");$optionsModal.trigger('saveOptions.ipWidget_ipForm',[options]);});$optionsModal.on('hide.bs.modal',function(){$('#ipWidgetFormPopup').show();});$this.modal();window[fieldType.optionsInitFunction]($this,currentOptions);},getFieldType:function(fieldType){var $this=this;var data=$this.data('ipWidget_ipForm_options');return data.fieldTypes[fieldType];},optionsAvailable:function(fieldTypeKey){var $this=this;var fieldType=$this.ipWidget_ipForm_options('getFieldType',fieldTypeKey);return(fieldType&&(fieldType.optionsInitFunction||fieldType.optionsHtml));}};$.fn.ipWidget_ipForm_options=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.ipWidget_ipForm_options');}};})(ip.jQuery);var IpWidget_Gallery;(function($){"use strict";IpWidget_Gallery=function(){this.$widgetObject=null;this.data=null;this.$controls=null;this.$widgetControls=null;this.init=function($widgetObject,data){var currentScope=this;this.$widgetObject=$widgetObject;this.data=data;this.$widgetControls=$('#ipWidgetGalleryControls');this.$widgetObject.on('click',$.proxy(this.focus,this));$('body').on('click',$.proxy(function(e){var $target=$(e.target);if(!$target.hasClass('ipWidget-Gallery')){$target=$target.closest('.ipWidget-Gallery');}
if($target.length==0||$target.data('widgetinstanceid')!=this.$widgetObject.data('widgetinstanceid')){$.proxy(this.blur,this)();}},this));var $list=this.$widgetObject.find('ul');$list.sortable();$list.disableSelection();$list.on("sortstart",function(event,ui){currentScope.dragItemOriginalPosition=$(ui.item).index();$.proxy(currentScope.blurImage,currentScope)();});$list.on("sortstop",function(event,ui){var data={};data.method='move';data.originalPosition=currentScope.dragItemOriginalPosition;data.newPosition=$(ui.item).index();if(data.newPosition!=data.originalPosition){currentScope.$widgetObject.save(data,true);}else{$(ui.item).click();}});this.$widgetObject.find('a').on('click',function(e){e.preventDefault();});this.$widgetObject.find('.ipsItem').on('click',$.proxy(this.focusImage,this));this.$controls=$('#ipWidgetGalleryMenu');$('body').on('click',$.proxy(function(e){var $target=$(e.target);var $closestLi=$target;if(!$target.hasClass('ipsItem')){$closestLi=$target.closest('.ipsItem');}
var $closestWidget=$closestLi.closest('.ipWidget-Gallery');if($closestWidget.length!=1){$.proxy(this.blurImage,this)();}},this));}
this.onAdd=function(e){this.$widgetObject.click();var thisContext=this;var repository=new ipRepository({preview:'thumbnails',filter:'image'});repository.on('ipRepository.filesSelected',$.proxy(thisContext.filesSelected,thisContext));repository.on('ipModuleRepository.cancel',function(){ipContent.deleteWidget(thisContext.$widgetObject.data('widgetinstanceid'));});}
this.focusImage=function(e){var context=this;e.preventDefault();var $item=$(e.currentTarget);var $img=$item.find('.ipsImage');var $controls=this.$controls;$controls.removeClass('ipgHide');$controls.css('position','absolute');$controls.css('left',$img.offset().left+5);$controls.css('top',$img.offset().top+5);this.imageIndex=$item.index();$controls.find('.ipsDelete').off().on('click',function(e){$.proxy(context.deleteImage,context)($item.index());});$controls.find('.ipsEdit').off().on('click',function(e){$.proxy(context.editImage,context)($item.index());})
$controls.find('.ipsLink').off().on('click',function(e){$.proxy(linkPopup,context)($item.index());});};this.blurImage=function(){this.$controls.addClass('ipgHide');};this.focus=function(){var thisContext=this;var $widgetControls=this.$widgetControls;var $widgetObject=this.$widgetObject;$widgetControls.removeClass('hide');$widgetControls.css('left',$widgetObject.offsetLeft);$widgetControls.css('top',$widgetObject.offsetTop);$widgetControls.css('position','absolute');$widgetControls.css('left',$widgetObject.offset().left);$widgetControls.css('top',$widgetObject.offset().top-$widgetControls.height()-5);$widgetControls.find('.ipsAdd').off().on('click',function(e){e.preventDefault();var repository=new ipRepository({preview:'thumbnails',filter:'image'});repository.on('ipRepository.filesSelected',$.proxy(thisContext.filesSelected,thisContext));});}
this.blur=function(){var $widgetControls=this.$widgetControls;$widgetControls.addClass('hide');};this.deleteImage=function(position){if(!this.data.images[1]){ipContent.deleteWidget(this.$widgetObject.data('widgetinstanceid'));return;}
var data={};data.method='delete';data.position=position;this.$widgetObject.save(data,true);};this.editImage=function(position){var thisContext=this;var $modal=$('#ipWidgetGalleryEditPopup');var options=new Object;var data=this.data.images[position];$modal.modal();if(data.imageOriginal){options.image=data.imageOriginal;}
if(data.cropX1){options.cropX1=data.cropX1;}
if(data.cropY1){options.cropY1=data.cropY1;}
if(data.cropX2){options.cropX2=data.cropX2;}
if(data.cropY2){options.cropY2=data.cropY2;}
options.enableChangeHeight=false;options.enableChangeWidth=false;options.enableUnderscale=true;options.autosizeType='crop';var $img=this.$widgetObject.find('.ipsImage').eq(position);if($img.length==1){options.windowWidth=$img.width();options.windowHeight=$img.height();}
var $editScreen=$modal.find('.ipsEditScreen');$editScreen.ipUploadImage('destroy');$editScreen.ipUploadImage(options);$modal.find('.ipsConfirm').off().on('click',function(){var crop=$editScreen.ipUploadImage('getCropCoordinates');var curImage=$editScreen.ipUploadImage('getCurImage');$.proxy(thisContext.updateImage,thisContext)(position,crop.x1,crop.y1,crop.x2,crop.y2,curImage);$modal.modal('hide');});}
this.updateImage=function(imageIndex,x1,y1,x2,y2,image,callback){var data={method:'update',fileName:image,imageIndex:imageIndex,cropX1:x1,cropY1:y1,cropX2:x2,cropY2:y2};this.$widgetObject.save(data,1,function($widget){$widget.click();if(callback){callback($widget);}});}
this.filesSelected=function(event,files){var data={method:'add'};$.each(files,function(key,value){if(!data.images){data.images=[];}
data.images[data.images.length]={fileName:value.fileName,status:"new"};});this.$widgetObject.save(data,1,function($widget){$widget.click();});}
var linkPopup=function(index){var context=this;this.popup=$('#ipWidgetGalleryLinkPopup');this.confirmButton=this.popup.find('.ipsConfirm');this.type=this.popup.find('select[name=type]');this.url=this.popup.find('input[name=url]');this.blank=this.popup.find('input[name=blank]');var data=this.data.images[index];if(data.type){this.type.val(data.type);}else{this.type.val('lightbox');}
if(data.url){this.url.val(data.url);}else{this.url.val('');}
if(data.blank){this.blank.attr('checked',true);}else{this.blank.attr('checked',false);}
this.type.off().on('change',function(){$.proxy(showHide,context)();});$.proxy(showHide,context)();this.popup.modal();this.confirmButton.off();this.confirmButton.on('click',$.proxy(saveLink,this));};var saveLink=function(){var data={method:'setLink',type:this.type.val(),url:this.url.val(),blank:this.blank.attr('checked')?1:0,index:this.imageIndex};this.$widgetObject.save(data,1);this.popup.modal('hide');};var showHide=function(){if(this.type.val()=='link'){this.popup.find('.form-group.name-url').show();this.popup.find('.form-group.name-blank').show();}else{this.popup.find('.form-group.name-url').hide();this.popup.find('.form-group.name-blank').hide();}}};})(ip.jQuery);var IpWidget_Html;(function($){"use strict";IpWidget_Html=function(){this.widgetObject=null;this.confirmButton=null;this.popup=null;this.data={};this.textarea=null;this.init=function(widgetObject,data){this.widgetObject=widgetObject;this.data=data;var container=this.widgetObject.find('.ipsContainer');if(this.data.html){container.html(this.data.html);}
var context=this;container.click(function(){$.proxy(openPopup,context)();});};this.onAdd=function(){$.proxy(openPopup,this)();};var openPopup=function(){this.popup=$('#ipWidgetHtmlPopup');this.confirmButton=this.popup.find('.ipsConfirm');this.textarea=this.popup.find('textarea[name=html]');if(this.data.html){this.textarea.val(this.data.html);}else{this.textarea.val('');}
this.popup.modal();this.confirmButton.off();this.confirmButton.on('click',$.proxy(save,this));};var save=function(){var data={html:this.textarea.val()};this.widgetObject.save(data,1);this.popup.modal('hide');};};})(ip.jQuery);var IpWidget_Image;(function($){"use strict";IpWidget_Image=function(){var controllerScope=this;this.$widgetObject=null;this.$imageUploader=null;this.data=null;this.init=function($widgetObject,data){this.$widgetObject=$widgetObject;this.data=data;this.$widgetObject.find('.ipsImage').on('click',function(){var $this=$(this);$this.resizable({aspectRatio:true,maxWidth:controllerScope.$widgetObject.width(),resize:function(event,ui){controllerScope.resize(Math.round(ui.size.width),Math.round(ui.size.height));}});});this.$controls=$('#ipWidgetImageMenu');this.$widgetObject.on('click',$.proxy(this.focusImage,this));$('body').on('click',$.proxy(function(e){var $target=$(e.target);var $closestWidget=$target.closest('.ipWidget-Image');if(!$target.hasClass('ipWidget-Image')&&!$closestWidget.hasClass('ipWidget-Image')){$.proxy(this.blurImage,this)();}},this));}
this.focusImage=function(e){var context=this;e.preventDefault();var $item=$(e.currentTarget);var $img=$item.find('.ipsImage');var $controls=this.$controls;$controls.removeClass('ipgHide');$controls.css('position','absolute');$controls.css('left',$img.offset().left+5);$controls.css('top',$img.offset().top+5);$controls.find('.ipsDelete').off().on('click',function(e){$.proxy(context.deleteImage,context)($item.index());});$controls.find('.ipsEdit').off().on('click',function(e){$.proxy(context.editImage,context)($item.index());});};this.blurImage=function(){this.$controls.addClass('ipgHide');};this.editImage=function(position){var thisContext=this;var $modal=$('#ipWidgetImageEditPopup');var options=new Object;var data=this.data;$modal.modal();if(data.imageOriginal){options.image=data.imageOriginal;}
if(data.cropX1){options.cropX1=data.cropX1;}
if(data.cropY1){options.cropY1=data.cropY1;}
if(data.cropX2){options.cropX2=data.cropX2;}
if(data.cropY2){options.cropY2=data.cropY2;}
options.enableChangeHeight=true;options.enableChangeWidth=true;options.maxWindowWidth=538;options.enableUnderscale=true;options.autosizeType='fit';var $img=this.$widgetObject.find('.ipsImage').eq(position);if($img.length==1){options.windowWidth=538;options.windowHeight=Math.round($img.height()/$img.width()*options.windowWidth);}
var $editScreen=$modal.find('.ipsEditScreen');$editScreen.ipUploadImage('destroy');$editScreen.ipUploadImage(options);$modal.find('.ipsConfirm').off().on('click',function(){var crop=$editScreen.ipUploadImage('getCropCoordinates');var curImage=$editScreen.ipUploadImage('getCurImage');$.proxy(thisContext.updateImage,thisContext)(crop.x1,crop.y1,crop.x2,crop.y2,curImage);$modal.modal('hide');});}
this.updateImage=function(x1,y1,x2,y2,image,callback){var data={method:'update',fileName:image,cropX1:x1,cropY1:y1,cropX2:x2,cropY2:y2};this.$widgetObject.save(data,1,function($widget){$widget.click();if(callback){callback($widget);}});}
this.onAdd=function(e){var thisContext=this;var repository=new ipRepository({preview:'thumbnails',filter:'image'});repository.on('ipRepository.filesSelected',$.proxy(thisContext.filesSelected,thisContext));repository.on('ipModuleRepository.cancel',function(){ipContent.deleteWidget(thisContext.$widgetObject.data('widgetinstanceid'));});}
this.filesSelected=function(event,files){var $this=$(this);var data={method:'newImage'};$.each(files,function(key,value){data.newImage=value.fileName;});this.$widgetObject.save(data,1);}
this.resize=function(width,height){var $this=$(this);var data={method:'resize',width:width,height:height};if(this.$widgetObject.width()-width<=2){data={method:'autosize'}}
this.$widgetObject.save(data,0);}};})(ip.jQuery);var IpWidget_Text;(function($){"use strict";IpWidget_Text=function(){this.$widgetObject=null;this.init=function($widgetObject,data){var customTinyMceConfig=ipTinyMceConfig();this.$widgetObject=$widgetObject;customTinyMceConfig.setup=function(ed,l){ed.on('change',function(e){$widgetObject.save({text:$widgetObject.find('.ipsContent').html()});})};$widgetObject.find('.ipsContent').tinymce(customTinyMceConfig);};this.onAdd=function(){this.$widgetObject.find('.ipsContent').focus();}};})(ip.jQuery);var IpWidget_Title;(function($){"use strict";IpWidget_Title=function(){this.$widgetObject=null;this.data=null;this.$header=null;this.$controls=null;this.init=function($widgetObject,data){var thisScope=this;this.$widgetObject=$widgetObject;this.data=data;this.$header=$widgetObject.find('h1,h2,h3,h4,h5,h6');this.$controls=$('#ipWidgetTitleControls');this.$header.tinymce(this.tinyMceConfig());this.$header.on('focus',$.proxy(this.focus,this));if(!data.level){this.data.level=1;}
this.$widgetObject.on('remove',$.proxy(this.destroy,this));if(!this.$header.css('min-height')||this.$header.css('min-height')=='0px'){this.$header.css('min-height',this.$header.css('font-size'));}};this.onAdd=function(){var $headTag=this.$widgetObject.find('h1,h2,h3,h4,h5,h6');$headTag.focus();}
this.focus=function(){this.initControls();}
this.blur=function(e){if($.contains(this.$widgetObject[0],e.target)||this.$widgetObject[0]==e.target){return;}else{if($.contains(this.$controls[0],e.target)||$.contains($('#ipWidgetTitleOptions')[0],e.target)){}else{this.removeControls()}}};this.removeControls=function(){this.$controls.addClass('hide');this.$controls.find('.ipsH').off();this.$controls.find('.ipsOptions').off();$('body').off('click.ipWidgetTitle');}
this.destroy=function(){this.removeControls();};this.saveOptions=function(data){this.data.anchor=data.anchor;this.save(false);}
this.openOptions=function(){var $modal=$('#ipWidgetTitleOptions');$modal.removeClass('hide');$modal.ipWidgetTitleModal({anchor:this.data.anchor,saveCallback:$.proxy(this.saveOptions,this)});};this.initControls=function(){var $controls=this.$controls;var $widgetObject=this.$widgetObject;$controls.removeClass('hide');$controls.css('left',$widgetObject.offsetLeft);$controls.css('top',$widgetObject.offsetTop);$controls.css('position','absolute');$controls.css('left',$widgetObject.offset().left);$controls.css('top',$widgetObject.offset().top-$controls.height()-5);$controls.find('.ipsH').on('click',$.proxy(this.levelPressed,this));$controls.find('.ipsH').removeClass('active');$controls.find('.ipsH[data-level="'+this.data.level+'"]').addClass('active');$controls.find('.ipsOptions').on('click',$.proxy(this.openOptions,this));$('body').on('click.ipWidgetTitle',$.proxy(this.blur,this));};this.levelPressed=function(e){this.removeControls();this.data.level=$(e.currentTarget).data('level');this.save(true);};this.save=function(refresh){var saveData={title:this.$widgetObject.find('h1,h2,h3,h4,h5,h6').text(),level:this.data.level,anchor:this.data.anchor};this.$widgetObject.save(saveData,refresh,function($widget){$widget.find('h1,h2,h3,h4,h5,h6').focus();});};this.tinyMceConfig=function(){var self=this;var customTinyMceConfig=ipTinyMceConfig();customTinyMceConfig.menubar=false;customTinyMceConfig.toolbar=false;customTinyMceConfig.setup=function(ed,l){ed.on('change',function(e){$.proxy(self.save,self)(false)});};customTinyMceConfig.paste_as_text=true;customTinyMceConfig.valid_elements='';customTinyMceConfig.custom_shortcuts=false;return customTinyMceConfig;};};})(ip.jQuery);(function($){"use strict";var methods={init:function(options){return this.each(function(){var $this=$(this);var saveCallback=options.saveCallback;$this.modal();$this.find('.ipsConfirm').on('click',function(){saveCallback({anchor:$this.find('.ipsAnchor').val()});$this.modal('hide');});$this.find('.ipsAnchor').on('keydown',$.proxy(methods.updateAnchor,$this));$this.find('.ipsAnchor').on('change',$.proxy(methods.updateAnchor,$this));$this.find('.ipsAnchor').on('keyup',$.proxy(methods.updateAnchor,$this));$this.find('.ipsAnchor').val(options.anchor);});},updateAnchor:function(){this.each(function(){var $this=$(this);var $preview=$this.find('.ipsAnchorPreview');var curText=$preview.text();var newText=curText.split('#')[0]+'#'+$this.find('.ipsAnchor').val();$preview.text(newText);});},destroy:function(){return this.each(function(){});}}
$.fn.ipWidgetTitleModal=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on ipWidgetTitleModal');}};})(ip.jQuery);var IpWidget_Video;(function($){"use strict";IpWidget_Video=function(){this.widgetObject=null;this.confirmButton=null;this.popup=null;this.data={};this.textarea=null;this.init=function(widgetObject,data){this.widgetObject=widgetObject;this.data=data;var container=this.widgetObject.find('.ipsContainer');if(this.data.html){container.html(this.data.html);}
var context=this;var $widgetOverlay=$('<div></div>').css('position','absolute').css('z-index',5).width(this.widgetObject.width()).height(this.widgetObject.height());this.widgetObject.prepend($widgetOverlay);$widgetOverlay.on('click',$.proxy(openPopup,context));};this.onAdd=function(){$.proxy(openPopup,this)();};var openPopup=function(){var context=this;this.popup=$('#ipWidgetVideoPopup');this.confirmButton=this.popup.find('.ipsConfirm');this.url=this.popup.find('input[name=url]');this.size=this.popup.find('select[name=size]');this.width=this.popup.find('input[name=width]');this.height=this.popup.find('input[name=height]');this.ratio=this.popup.find('select[name=ratio]');if(this.data.url){this.url.val(this.data.url);}else{this.url.val('');}
if(this.data.size){this.size.val(this.data.size);}else{this.size.val('auto');}
if(this.data.width){this.width.val(this.data.width);}else{this.width.val('853');}
if(this.data.height){this.height.val(this.data.height);}else{this.height.val('480');}
if(this.data.ratio){this.ratio.val(this.data.ratio);}else{this.ratio.val('16:9');}
this.size.on('change',function(){$.proxy(showHide,context)();});$.proxy(showHide,context)();this.popup.modal();this.confirmButton.off();this.confirmButton.on('click',$.proxy(save,this));};var save=function(){var data={url:this.url.val(),size:this.size.val(),width:this.width.val(),height:this.height.val(),ratio:this.ratio.val()};this.widgetObject.save(data,1);this.popup.modal('hide');};var showHide=function(){if(this.size.val()=='auto'){this.popup.find('.form-group.name-ratio').show();this.popup.find('.form-group.name-width').hide();this.popup.find('.form-group.name-height').hide();}else{this.popup.find('.form-group.name-ratio').hide();this.popup.find('.form-group.name-width').show();this.popup.find('.form-group.name-height').show();}}};})(ip.jQuery);