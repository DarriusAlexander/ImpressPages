(function($){$.support.touch="ontouchend" in document;if(!$.support.touch){return}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,"mouseover");simulateMouseEvent(event,"mousemove");simulateMouseEvent(event,"mousedown")};mouseProto._touchMove=function(event){if(!touchHandled){return}this._touchMoved=true;simulateMouseEvent(event,"mousemove")};mouseProto._touchEnd=function(event){if(!touchHandled){return}simulateMouseEvent(event,"mouseup");simulateMouseEvent(event,"mouseout");if(!this._touchMoved){simulateMouseEvent(event,"click")}touchHandled=false};mouseProto._mouseInit=function(){var self=this;self.element.bind("touchstart",$.proxy(self,"_touchStart")).bind("touchmove",$.proxy(self,"_touchMove")).bind("touchend",$.proxy(self,"_touchEnd"));_mouseInit.call(self)}})(ip.jQuery);(function($){$(document).ready(function(){$(document).bind("initFinished.ipContentManagement",function(){$(".ipActionWidgetButton").bind("dragstart",function(event,ui){$(".ipBlock > .ipbExampleContent").each(function(){var $ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.css("min-height")){$block.data("ipMinHeight",$block.css("min-height"))}$block.css("min-height",$block.height());$ipExampleContent.fadeOut("slow")})}).bind("dragstop",function(event,ui){$(".ipBlock > .ipbExampleContent").each(function(){var $ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.children(".ipAdminWidgetPlaceholder").length){$ipExampleContent.remove()}else{$ipExampleContent.fadeIn("fast")}if(!$block.data("ipMinHeight")){$block.css("min-height","")}else{$block.css("min-height",$block.data("ipMinHeight"));$block.removeData("ipMinHeight")}})})})})})(ip.jQuery);(function($){$(document).ready(function(){var $ipObject=$(document);$ipObject.bind("initFinished.ipContentManagement",ipAdminPanelInit);$ipObject.bind("initFinished.ipContentManagement",ipAdminWidgetsScroll);$(window).bind("resizeEnd",ipAdminWidgetsScroll);$ipObject.bind("initFinished.ipContentManagement",ipAdminWidgetsSearch);$ipObject.ipContentManagement();ip.jQuery.expr[":"].icontains=function(a,i,m){return ip.jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0};if(isMobile){$("body").addClass("ipMobile")}});$(window).resize(function(){if(this.resizeTO){clearTimeout(this.resizeTO)}this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},100)})})(ip.jQuery);function ipAdminWidgetsScroll(){var $scrollable=$(".ipAdminWidgetsContainer");$scrollable.scrollable({items:"li",touch:false});var scrollableAPI=$scrollable.data("scrollable");var itemWidth=scrollableAPI.getItems().eq(0).outerWidth(true);var containerWidth=scrollableAPI.getRoot().width()+24;var scrollBy=Math.floor(containerWidth/itemWidth);if(scrollBy<1){scrollBy=1}$(".ipAdminWidgets .ipaRight, .ipAdminWidgets .ipaLeft").unbind("click");scrollableAPI.begin();$(".ipAdminWidgets .ipaRight").click(function(event){event.preventDefault();scrollableAPI.move(scrollBy)});$(".ipAdminWidgets .ipaLeft").click(function(event){event.preventDefault();scrollableAPI.move(-scrollBy)})}function ipAdminWidgetsSearch(){var $input=$(".ipAdminWidgetsSearch .ipaInput");var $button=$(".ipAdminWidgetsSearch .ipaButton");var $widgets=$(".ipAdminWidgetsContainer li");$input.focus(function(){if(this.value==this.defaultValue){this.value=""}}).blur(function(){if(this.value==""){this.value=this.defaultValue}}).keyup(function(){var value=this.value;$widgets.css("display","");if(value&&value!=this.defaultValue){$widgets.not(":icontains("+value+")").css("display","none");$button.addClass("ipaClear")}else{$button.removeClass("ipaClear")}ipAdminWidgetsScroll()});$button.click(function(event){event.preventDefault();var $this=$(this);if($this.hasClass("ipaClear")){$input.val("").blur().keyup();$this.removeClass("ipaClear")}})}function ipAdminPanelInit(){var $container=$(".ipAdminPanelContainer");var $panel=$(".ipAdminPanel");$container.height($panel.height());$panel.css("top",$(".ipsAdminToolbarContainer").outerHeight())}var widgetOnDroppable=false;function ipStartWidgetDrag(){$(".ipWidget").each(function(key,value){var $droppable=$('<div class="ipsWidgetDropPlaceholder" style="width: 10px; background-color: #000;"></div>');$("body").append($droppable);$droppable.css("position","absolute");$droppable.css("left",$(value).offset().left-$droppable.width()+"px");$droppable.css("top",$(value).offset().top+10+"px");$droppable.css("height",$(value).height()-20+"px");$droppable.data("instanceId",$(value).data("widgetinstanceid"));$droppable.data("leftOrRight","left");var $droppable=$('<div class="ipsWidgetDropPlaceholder" style="width: 10px; background-color: #000;"></div>');$("body").append($droppable);$droppable.css("position","absolute");$droppable.css("left",$(value).offset().left+$(value).width()+"px");$droppable.css("top",$(value).offset().top+10+"px");$droppable.css("height",$(value).height()-20+"px");$droppable.data("instanceId",$(value).data("widgetinstanceid"));$droppable.data("leftOrRight","right")});$(".ipsWidgetDropPlaceholder").droppable({accept:".ipActionWidgetButton, .ipWidget",activeClass:"ui-state-hover",hoverClass:"ui-state-active",over:function(event,ui){widgetOnDroppable=$(this)},out:function(event,ui){widgetOnDroppable=false},drop:function(event,ui){}});console.log("start")}function ipStopWidgetDrag(){$(".ipsWidgetDropPlaceholder").remove()}function ipMoveWidgetToSide(widgetInstanceId,targetWidgetInstanceId,leftOrRight){}function ipAddWidgetToSide(widgetName,targetWidgetInstanceId,leftOrRight){console.log(widgetName);console.log(targetWidgetInstanceId);console.log(leftOrRight)}(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipBlock");if(!data){$this.delegate(".ipActionWidgetMove","click",function(e){e.preventDefault()});$this.sortable({connectWith:".ipBlock",revert:true,dropOnEmpty:true,forcePlaceholderSize:false,placeholder:"ipAdminWidgetPlaceholder",handle:".ipAdminWidgetControls .ipActionWidgetMove",start:function(event,ui){ui.item.addClass("ipAdminWidgetDrag");ui.item.width(ui.item.find(".ipAdminWidgetMoveIcon").outerWidth());ui.item.height(ui.item.find(".ipAdminWidgetMoveIcon").outerHeight())},stop:function(event,ui){ui.item.removeClass("ipAdminWidgetDrag");ui.item.width("auto");ui.item.height("auto")},update:function(event,ui){if(!$(ui.item).data("widgetinstanceid")){return}if($(ui.item).parent().data("ipBlock").name!=$this.data("ipBlock").name){return}var instanceId=$(ui.item).data("widgetinstanceid");var position=$(ui.item).index();var data=Object();data.aa="Content.moveWidget";data.securityToken=ip.securityToken;data.instanceId=instanceId;data.position=position;data.blockName=$this.data("ipBlock").name;data.revisionId=$this.data("ipBlock").revisionId;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:methods._moveWidgetResponse,dataType:"json"})},receive:function(event,ui){$element=$(ui.item);if($element&&$element.is(".ipActionWidgetButton")){$duplicatedDragItem=$(".ipBlock .ipActionWidgetButton");$position=$duplicatedDragItem.index();var newWidgetName=$element.data("ipAdminWidgetButton").name;$duplicatedDragItem.remove();$block=$this;$block.ipBlock("_createWidget",newWidgetName,$position)}}});$this.data("ipBlock",{name:$this.attr("id").substr(8),revisionId:$this.data("revisionid"),widgetControlsHtml:options.widgetControlsHtml});var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data("ipBlock").widgetControlsHtml;$this.children(".ipWidget").ipWidget(widgetOptions);$this.delegate(".ipWidget .ipActionWidgetDelete","click",function(event){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}event.preventDefault();$(this).trigger("deleteClick.ipBlock")});$this.delegate(".ipWidget","deleteClick.ipBlock",function(event){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}var $instance=$(this),instanceData=$instance.data("widgetdata"),instanceId=$instance.data("widgetinstanceid"),$subwidgets=$instance.find(".ipWidget");$subwidgets.each(function(){$(this).trigger("deleteWidget.ipBlock",{instanceId:$(this).data("widgetinstanceid")})});$instance.trigger("deleteWidget.ipBlock",{instanceId:instanceId})});$this.bind("deleteWidget.ipBlock",function(event,data){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}$(this).ipBlock("deleteWidget",data.instanceId)});$this.bind("reinitRequired.ipWidget",function(event){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}$(this).ipBlock("reinit")})}})},reinit:function(){return this.each(function(){var $this=$(this);var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data("ipBlock").widgetControlsHtml;$(this).children(".ipWidget").ipWidget(widgetOptions)})},_moveWidgetResponse:function(response){var $this=$(this);if(response.status=="success"){$("#ipWidget-"+response.oldInstance).replaceWith(response.widgetHtml);$this.trigger("reinitRequired.ipWidget")}},pageSaveStart:function(){return this.each(function(){var $this=$(this);$(this).children(".ipWidget").ipWidget("fetchManaged").ipWidget("save")})},destroy:function(){},_showError:function(errorMessage){alert(errorMessage)},deleteWidget:function(instanceId){return this.each(function(){var $this=$(this);var data=Object();data.aa="Content.deleteWidget";data.securityToken=ip.securityToken;data.instanceId=instanceId;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:methods._deleteWidgetResponse,dataType:"json"})})},_deleteWidgetResponse:function(response){var $this=$(this);$this.find("#ipWidget-"+response.widgetId).remove();if($this.children(".ipWidget").length==0){$this.addClass("ipbEmpty")}},_createWidget:function(widgetName,position){return this.each(function(){var $this=$(this);var data=Object();data.aa="Content.createWidget";data.securityToken=ip.securityToken;data.widgetName=widgetName;data.position=position;data.blockName=$this.data("ipBlock").name;data.zoneName=$this.data("ipBlock").zoneName;data.pageId=$this.data("ipBlock").pageId;data.revisionId=$this.data("ipBlock").revisionId;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:methods._createWidgetResponse,dataType:"json"})})},_createWidgetResponse:function(response){var $this=$(this);if(response.status=="error"){$.fn.ipBlock("_showError",response.errorMessage)}if(response.status=="success"){var $newWidget=$(response.widgetHtml);if(response.position==0){$(this).prepend($newWidget)}else{$secondChild=$(this).children(".ipWidget:nth-child("+response.position+")");$newWidget.insertAfter($secondChild)}$this.trigger("reinitRequired.ipWidget");$this.trigger("addWidget.ipWidget",{instanceId:response.instanceId,widget:$newWidget});var widgetController=$newWidget.ipWidget("widgetController");if(widgetController&&typeof(widgetController.onAdd)==="function"){widgetController.onAdd($newWidget)}}if($this.hasClass("ipbEmpty")){$this.removeClass("ipbEmpty")}}};$.fn.ipBlock=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipContentManagement");if(!data){$this.bind("initFinished.ipContentManagement",$.proxy(methods._initBlocks,$this));$(this).trigger("initStarted.ipContentManagement");$this.data("ipContentManagement",{saveJobs:Object(),optionsChanged:false});var data=$this.data("ipContentManagement");$("body").prepend(ipContentInit.saveProgressHtml);$("body").prepend(ipContentInit.controlPanelHtml);var options=new Object;options.zoneName=ip.zoneName;options.pageId=ip.pageId;options.revisionId=ip.revisionId;options.widgetControlsHtml=ipContentInit.widgetControlsHtml;options.contentManagementObject=$this;options.manageableRevision=ipContentInit.manageableRevision;var data=$this.data("ipContentManagement");data.initInfo=options;$this.data("ipContentManagement",data);$(".ipAdminPanel .ipActionWidgetButton").ipAdminWidgetButton();$(".ipAdminPanel .ipActionSave").bind("click",function(e){$.proxy(methods.save,$this)(false)});$(".ipAdminPanel .ipActionPublish").bind("click",function(e){$.proxy(methods.save,$this)(true)});$(".ipAdminPanelContainer .ipsPreview").on("click",function(e){e.preventDefault();ipContent.setManagementMode(0)});$this.bind("error.ipContentManagement",function(event,error){$(this).ipContentManagement("addError",error)});$this.trigger("initFinished.ipContentManagement",options)}})},_initBlocks:function(){var $this=this;$this.ipContentManagement("initBlocks",$(".ipBlock"))},initBlocks:function(blocks){var $this=this;var data=$this.data("ipContentManagement");var options=data.initInfo;if(options.manageableRevision){blocks.ipBlock(options)}},addError:function(errorMessage){var $newError=$(".ipAdminErrorSample .ipAdminError").clone();$newError.text(errorMessage);$(".ipAdminErrorContainer").append($newError);$newError.animate({opacity:"100%"},6000).animate({queue:true,opacity:"0%"},{duration:3000,complete:function(){$(this).remove()}})},save:function(publish){return this.each(function(){var $this=$(this);var data=$this.data("ipContentManagement");var postData=Object();postData.aa="Content.savePage";postData.securityToken=ip.securityToken;postData.revisionId=ip.revisionId;if(publish){postData.publish=1}else{postData.publish=0}$.ajax({type:"POST",url:ip.baseUrl,data:postData,context:$this,success:methods._savePageResponse,dataType:"json"})})},_savePageResponse:function(response){var $this=$(this);var data=$this.data("ipContentManagement");if(response.status=="success"){window.location.href=response.newRevisionUrl}else{}}};$.fn.ipContentManagement=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var $list=$this.find(".ipsList");$list.html("");var $itemTemplate=$this.find(".ipsItemTemplate");$.each(options.layouts,function(key,value){var $newItem=$itemTemplate.clone().detach().text(value.title).data("layout",value.name);if(value.name==options.currentLayout){$newItem.addClass("active");$newItem.on("click",function(e){e.preventDefault();$this.modal("hide")})}else{$newItem.on("click",function(e){e.preventDefault();options.widgetObject.ipWidget("changeLayout",value.name);$this.modal("hide")})}$list.append($newItem)});$this.modal()})}};$.fn.ipLayoutModal=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on ipLayoutModal")}}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);$this.prepend(options.widgetControlls);$this.save=function(data,refresh,callback){$(this).ipWidget("save",data,refresh,callback)};var data=$this.data("ipWidgetInit");if(!data){$this.data("ipWidgetInit",Object());var widgetName=$this.data("widgetname");var data=$this.data("widgetdata");var functionClass="IpWidget_"+widgetName;if(typeof(window[functionClass])=="function"){var widgetController;widgetController=new window[functionClass];if(widgetController.init){widgetController.init($this,data)}$this.data("widgetController",widgetController)}}$this.find(".ipsLook").on("click",$.proxy(openLayoutModal,this))})},widgetController:function(){return this.data("widgetController")},save:function(widgetData,refresh,callback){return this.each(function(){var $this=$(this);var $queue=$this.data("saveQueue");if($queue==null){$queue=[]}$queue.push({widgetData:widgetData,refresh:refresh,callback:callback});$this.data("saveQueue",$queue);if($this.data("saveInProgress")){return}else{$.proxy(processSaveQueue,$this)()}})},changeLook:function(look){return this.each(function(){var $this=$(this);var data=Object();data.aa="Content.changeLook";data.securityToken=ip.securityToken;data.instanceId=$this.data("widgetinstanceid");data.layout=look;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:function(response){var $newWidget=$(response.previewHtml);$($newWidget).insertAfter($this);$newWidget.trigger("reinitRequired.ipWidget");$(document).ipContentManagement("initBlocks",$newWidget.find(".ipBlock"));$this.remove()},error:function(response){console.log(response)},dataType:"json"})})}};var processSaveQueue=function(){var $this=this;if($this.data("saveInProgress")){return}else{$this.data("saveInProgress",true)}var $queue=$this.data("saveQueue");$this.data("saveQueue",[]);if($queue==null||$queue.length==0){$this.data("saveInProgress",false);return}var refresh=false;var callbacks=[];$.each($queue,function(key,value){if(value.refresh){refresh=true}if(value.callback){callbacks.push(value.callback)}});var data=Object();data.aa="Content.updateWidget";data.securityToken=ip.securityToken;data.instanceId=$this.data("widgetinstanceid");data.widgetData=$queue[$queue.length-1].widgetData;if(refresh){data.generatePreview=1}$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:function(response){var $this=this;if(refresh){var newWidget=response.previewHtml;var $newWidget=$(newWidget);$newWidget.insertAfter($this);$newWidget.trigger("reinitRequired.ipWidget");$(document).ipContentManagement("initBlocks",$newWidget.find(".ipBlock"));$this.remove()}if(callbacks.length){if(refresh){$.each(callbacks,function(key,value){value($newWidget)})}else{$.each(callbacks,function(key,value){value($this)})}}$this.data("saveInProgress",false);$.proxy(processSaveQueue,$this)()},error:function(response){console.log(response);$this.data("saveInProgress",false);$.proxy(processSaveQueue,$this)()},dataType:"json"})};var openLayoutModal=function(e){e.preventDefault();var $this=$(this);var $layoutButton=$this.find(".ipsLook");var layouts=$layoutButton.data("layouts");var currentLayout=$layoutButton.data("currentlayout");var $modal=$("#ipWidgetLayoutPopup");$modal.ipLayoutModal({layouts:layouts,currentLayout:currentLayout,widgetObject:$this})};$.fn.ipWidget=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipWidget")}}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipAdminWidgetButton");if(!data){$this.draggable({connectToSortable:".ipBlock",revert:function(droppable){if(droppable===false){$this.trigger("unsuccessfulDrop.ipWidgetButton",{widgetButton:$this});return true}else{$this.trigger("successfulDrop.ipWidgetButton",{widgetButton:$this,block:droppable});return false}},helper:"clone",stop:function(event,ui){if(widgetOnDroppable){var targetWidgetInstanceId=widgetOnDroppable.data("instanceId");var leftOrRight=widgetOnDroppable.data("leftOrRight");var widgetName=$(this).data("ipAdminWidgetButton").name;ipAddWidgetToSide(widgetName,targetWidgetInstanceId,leftOrRight)}ipStopWidgetDrag()},start:function(event,ui){ipStartWidgetDrag()}});$this.data("ipAdminWidgetButton",{name:$this.attr("id").substr(20)})}$this.find("a").bind("click",function(){return false})})},destroy:function(){}};$.fn.ipAdminWidgetButton=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);