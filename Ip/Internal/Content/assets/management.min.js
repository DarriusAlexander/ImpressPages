(function($){var widgetOnDroppable=false;var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipContentManagement");if(!data){$this.data("ipContentManagement",{});$(window).resize(function(){if(this.resizeTO){clearTimeout(this.resizeTO)}this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},100)});$(window).bind("resizeEnd",ipAdminWidgetsScroll);ip.jQuery.expr[":"].icontains=function(a,i,m){return ip.jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0};if(isMobile){$("body").addClass("ipMobile")}$("body").prepend(ipContentInit.saveProgressHtml);$("body").prepend(ipContentInit.controlPanelHtml);var options=new Object;options.zoneName=ip.zoneName;options.pageId=ip.pageId;options.revisionId=ip.revisionId;options.widgetControlsHtml=ipContentInit.widgetControlsHtml;options.contentManagementObject=$this;options.manageableRevision=ipContentInit.manageableRevision;var data=$this.data("ipContentManagement");data.initInfo=options;$this.data("ipContentManagement",data);$(".ipAdminPanel .ipActionWidgetButton").ipAdminWidgetButton();ipAdminPanelInit();ipAdminWidgetsScroll();ipAdminWidgetsSearch();$(".ipAdminPanel .ipActionWidgetButton").on("dragstart",ipStartWidgetDrag);$(".ipAdminPanel .ipActionWidgetButton").on("dragstop",ipStopWidgetDrag);$(".ipAdminPanel .ipActionSave").on("click",function(e){$.proxy(methods.save,$this)(false)});$(".ipAdminPanel .ipActionPublish").on("click",function(e){$.proxy(methods.save,$this)(true)});$(".ipAdminPanelContainer .ipsPreview").on("click",function(e){e.preventDefault();ipManagementMode.setManagementMode(0)});$this.on("error.ipContentManagement",function(event,error){$(this).ipContentManagement("addError",error)});$.proxy(methods.initBlocks,$this)($(".ipBlock"));$this.trigger("initFinished.ipContentManagement",options)}})},initBlocks:function(blocks){var $this=this;var data=$this.data("ipContentManagement");var options=data.initInfo;if(options.manageableRevision){blocks.ipBlock(options)}},addError:function(errorMessage){var $newError=$(".ipAdminErrorSample .ipAdminError").clone();$newError.text(errorMessage);$(".ipAdminErrorContainer").append($newError);$newError.animate({opacity:"100%"},6000).animate({queue:true,opacity:"0%"},{duration:3000,complete:function(){$(this).remove()}})},save:function(publish){return this.each(function(){var $this=$(this);var data=$this.data("ipContentManagement");var postData=Object();postData.aa="Content.savePage";postData.securityToken=ip.securityToken;postData.revisionId=ip.revisionId;if(publish){postData.publish=1}else{postData.publish=0}$.ajax({type:"POST",url:ip.baseUrl,data:postData,context:$this,success:methods._savePageResponse,dataType:"json"})})},_savePageResponse:function(response){var $this=$(this);var data=$this.data("ipContentManagement");if(response.status=="success"){window.location.href=response.newRevisionUrl}else{}}};var ipAdminWidgetsScroll=function(){var $scrollable=$(".ipAdminWidgetsContainer");$scrollable.scrollable({items:"li",touch:false});var scrollableAPI=$scrollable.data("scrollable");var itemWidth=scrollableAPI.getItems().eq(0).outerWidth(true);var containerWidth=scrollableAPI.getRoot().width()+24;var scrollBy=Math.floor(containerWidth/itemWidth);if(scrollBy<1){scrollBy=1}$(".ipAdminWidgets .ipaRight, .ipAdminWidgets .ipaLeft").unbind("click");scrollableAPI.begin();$(".ipAdminWidgets .ipaRight").click(function(event){event.preventDefault();scrollableAPI.move(scrollBy)});$(".ipAdminWidgets .ipaLeft").click(function(event){event.preventDefault();scrollableAPI.move(-scrollBy)})};var ipAdminWidgetsSearch=function(){var $input=$(".ipAdminWidgetsSearch .ipaInput");var $button=$(".ipAdminWidgetsSearch .ipaButton");var $widgets=$(".ipAdminWidgetsContainer li");$input.focus(function(){if(this.value==this.defaultValue){this.value=""}}).blur(function(){if(this.value==""){this.value=this.defaultValue}}).keyup(function(){var value=this.value;$widgets.css("display","");if(value&&value!=this.defaultValue){$widgets.not(":icontains("+value+")").css("display","none");$button.addClass("ipaClear")}else{$button.removeClass("ipaClear")}ipAdminWidgetsScroll()});$button.click(function(event){event.preventDefault();var $this=$(this);if($this.hasClass("ipaClear")){$input.val("").blur().keyup();$this.removeClass("ipaClear")}})};var ipAdminPanelInit=function(){var $container=$(".ipAdminPanelContainer");var $panel=$(".ipAdminPanel");$container.height($panel.height());$panel.css("top",$(".ipsAdminToolbarContainer").outerHeight())};var ipStartWidgetDrag=function(event,ui){$(".ipBlock > .ipWidget").not(".ipWidget .ipWidget").each(function(key,value){var $droppable=$('<div class="ipsWidgetDropPlaceholder widgetDropPlaceholder"></div>');$("body").append($droppable);$droppable.css("position","absolute");$droppable.css("left",$(value).offset().left-$droppable.width()+"px");$droppable.css("top",$(value).offset().top+1+"px");$droppable.css("height",Math.max($(value).height()-2,10)+"px");$droppable.data("instanceId",$(value).data("widgetinstanceid"));$droppable.data("leftOrRight","left");var $droppable=$('<div class="ipsWidgetDropPlaceholder widgetDropPlaceholder"></div>');$("body").append($droppable);$droppable.css("position","absolute");$droppable.css("left",$(value).offset().left+$(value).width()+"px");$droppable.css("top",$(value).offset().top+1+"px");$droppable.css("height",Math.max($(value).height()-2,10)+"px");$droppable.data("instanceId",$(value).data("widgetinstanceid"));$droppable.data("leftOrRight","right")});$(".ipsWidgetDropPlaceholder").droppable({accept:".ipActionWidgetButton, .ipWidget",activeClass:"",hoverClass:"hover",over:function(event,ui){widgetOnDroppable=$(this)},out:function(event,ui){widgetOnDroppable=false},drop:function(event,ui){}})};var ipStopWidgetDrag=function(event,ui){if(widgetOnDroppable){var targetWidgetInstanceId=widgetOnDroppable.data("instanceId");var leftOrRight=widgetOnDroppable.data("leftOrRight");var widgetName=$(this).data("ipAdminWidgetButton").name;ipContent.createWidgetToSide(widgetName,targetWidgetInstanceId,leftOrRight)}$(".ipsWidgetDropPlaceholder").remove()};var ipMoveWidgetToSide=function(widgetInstanceId,targetWidgetInstanceId,leftOrRight){};$.fn.ipContentManagement=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);(function($){$(document).ready(function(){$(document).ipContentManagement()})})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipAdminWidgetButton");if(!data){$this.draggable({connectToSortable:".ipBlock",revert:function(droppable){if(droppable===false){$this.trigger("unsuccessfulDrop.ipWidgetButton",{widgetButton:$this});return true}else{$this.trigger("successfulDrop.ipWidgetButton",{widgetButton:$this,block:droppable});return false}},helper:function(e){var $button=$(e.currentTarget);var $result=$button.clone();$result.find("span").remove();$result.css("paddingTop","15px");console.log($result.height());return $result},opacity:0.45,cursorAt:{left:30,top:45},stop:function(event,ui){},start:function(event,ui){}});$this.data("ipAdminWidgetButton",{name:$this.attr("id").substr(20)})}$this.find("a").bind("click",function(){return false})})},destroy:function(){}};$.fn.ipAdminWidgetButton=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipBlock");if(!data){$this.delegate(".ipActionWidgetMove","click",function(e){e.preventDefault()});$this.sortable({connectWith:".ipBlock",revert:true,dropOnEmpty:true,forcePlaceholderSize:false,placeholder:"ipAdminWidgetPlaceholder",handle:".ipAdminWidgetControls .ipActionWidgetMove",start:function(event,ui){ui.item.addClass("ipAdminWidgetDrag");ui.item.width(ui.item.find(".ipAdminWidgetMoveIcon").outerWidth());ui.item.height(ui.item.find(".ipAdminWidgetMoveIcon").outerHeight())},stop:function(event,ui){ui.item.removeClass("ipAdminWidgetDrag");ui.item.width("auto");ui.item.height("auto")},update:function(event,ui){if(!$(ui.item).data("widgetinstanceid")){return}if($(ui.item).parent().data("ipBlock").name!=$this.data("ipBlock").name){return}var instanceId=$(ui.item).data("widgetinstanceid");var position=$(ui.item).index();var block=$this.data("ipBlock").name;var revisionId=$this.data("ipBlock").revisionId;ipContent.moveWidget(instanceId,position,block,revisionId)},receive:function(event,ui){var $element=$(ui.item);if($element&&$element.is(".ipActionWidgetButton")){var $duplicatedDragItem=$(".ipBlock .ipActionWidgetButton");var position=$duplicatedDragItem.index();var newWidgetName=$element.data("ipAdminWidgetButton").name;$duplicatedDragItem.remove();var $block=$this;var $revisionId=$block.data("ipBlock").revisionId;var blockName=$block.data("ipBlock").name;ipContent.createWidget($revisionId,blockName,newWidgetName,position)}}});$this.data("ipBlock",{name:$this.attr("id").substr(8),revisionId:$this.data("revisionid"),widgetControlsHtml:options.widgetControlsHtml});var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data("ipBlock").widgetControlsHtml;$this.children(".ipWidget").ipWidget(widgetOptions);$this.bind("reinitRequired.ipWidget",function(event){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}$(this).ipBlock("reinit")});$this.on("click","> .ipbExampleContent",function(){var $block=$this;var $exampleContent=$(this);ipContent.createWidget(ip.revisionId,$block.data("ipBlock").name,"Text",0);$exampleContent.remove()})}})},reinit:function(){return this.each(function(){var $this=$(this);var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data("ipBlock").widgetControlsHtml;$(this).children(".ipWidget").ipWidget(widgetOptions)})},destroy:function(){}};$.fn.ipBlock=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);$this.prepend(options.widgetControlls);$this.save=function(data,refresh,callback){$(this).ipWidget("save",data,refresh,callback)};var data=$this.data("ipWidgetInit");if(!data){$this.data("ipWidgetInit",Object());var widgetName=$this.data("widgetname");var data=$this.data("widgetdata");var functionClass="IpWidget_"+widgetName;if(typeof(window[functionClass])=="function"){var widgetController;widgetController=new window[functionClass];if(widgetController.init){widgetController.init($this,data)}$this.data("widgetController",widgetController)}}$this.find(".ipActionWidgetDelete").on("click",function(e){e.preventDefault();ipContent.deleteWidget($this.data("widgetinstanceid"))});$this.find(".ipsLook").on("click",$.proxy(openLayoutModal,this))})},widgetController:function(){return this.data("widgetController")},save:function(widgetData,refresh,callback){return this.each(function(){var $this=$(this);var $queue=$this.data("saveQueue");if($queue==null){$queue=[]}$queue.push({widgetData:widgetData,refresh:refresh,callback:callback});$this.data("saveQueue",$queue);if($this.data("saveInProgress")){return}else{$.proxy(processSaveQueue,$this)()}})},changeLook:function(look){return this.each(function(){var $this=$(this);var data=Object();data.aa="Content.changeLook";data.securityToken=ip.securityToken;data.instanceId=$this.data("widgetinstanceid");data.look=look;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:function(response){var $newWidget=$(response.html);$($newWidget).insertAfter($this);$newWidget.trigger("reinitRequired.ipWidget");$(document).ipContentManagement("initBlocks",$newWidget.find(".ipBlock"));$this.remove()},error:function(response){console.log(response)},dataType:"json"})})}};var processSaveQueue=function(){var $this=this;if($this.data("saveInProgress")){return}else{$this.data("saveInProgress",true)}var $queue=$this.data("saveQueue");$this.data("saveQueue",[]);if($queue==null||$queue.length==0){$this.data("saveInProgress",false);return}var refresh=false;var callbacks=[];$.each($queue,function(key,value){if(value.refresh){refresh=true}if(value.callback){callbacks.push(value.callback)}});var data=Object();data.aa="Content.updateWidget";data.securityToken=ip.securityToken;data.instanceId=$this.data("widgetinstanceid");data.widgetData=$queue[$queue.length-1].widgetData;if(refresh){data.generatePreview=1}$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:function(response){var $this=this;if(refresh){var newWidget=response.html;var $newWidget=$(newWidget);$newWidget.insertAfter($this);$newWidget.trigger("reinitRequired.ipWidget");$(document).ipContentManagement("initBlocks",$newWidget.find(".ipBlock"));$this.remove()}if(callbacks.length){if(refresh){$.each(callbacks,function(key,value){value($newWidget)})}else{$.each(callbacks,function(key,value){value($this)})}}$this.data("saveInProgress",false);$.proxy(processSaveQueue,$this)()},error:function(response){console.log("save error");console.log(response);$this.data("saveInProgress",false);$.proxy(processSaveQueue,$this)()},dataType:"json"})};var openLayoutModal=function(e){e.preventDefault();var $this=$(this);var $layoutButton=$this.find(".ipsLook");var layouts=$layoutButton.data("layouts");var currentLayout=$layoutButton.data("currentlayout");var $modal=$("#ipWidgetLayoutPopup");$modal.ipLayoutModal({layouts:layouts,currentLayout:currentLayout,widgetObject:$this})};$.fn.ipWidget=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipWidget")}}}})(ip.jQuery);var ipContent;(function($){ipContent=new function(){this.deleteWidget=function(instanceId,callback){var $widget=$("#ipWidget-"+instanceId);var $subwidgets=$widget.find(".ipWidget");var $this=$(this);var data=Object();data.aa="Content.deleteWidget";data.securityToken=ip.securityToken;data.instanceId=Array();$.each($subwidgets,function(key,widget){var $widget=$(widget);data.instanceId.push($widget.data("widgetinstanceid"))});data.instanceId.push(instanceId);$.ajax({type:"POST",url:ip.baseUrl,data:data,success:function(response){var $block=$widget.closest(".ipBlock");$widget.remove();if($block.children(".ipWidget").length==0){$this.addClass("ipbEmpty")}if(callback){callback($newWidget.data("widgetinstanceid"))}},dataType:"json"})};this.moveWidgetToSide=function(sourceWidgetInstanceId,targetWidgetInstanceId,leftOrRight,callback){};this.createWidgetToSide=function(widgetName,targetWidgetInstanceId,leftOrRight,callback){var createdWidgetInstanceId;var revisionId=ip.revisionId;createSpace(targetWidgetInstanceId,leftOrRight,function(newWidgetBlockName){ipContent.createWidget(revisionId,newWidgetBlockName,widgetName,0,function(instanceId){createdWidgetInstanceId=instanceId})});if(callback){callback($newWidget.data("widgetinstanceid"))}};var createSpace=function(targetWidgetInstanceId,leftOrRight,callback){var newWidgetBlockName;var $targetWidget=$("#ipWidget-"+targetWidgetInstanceId);var $targetBlock=$targetWidget.closest(".ipBlock");var targetBlockName=$targetBlock.data("ipBlock").name;var targetPosition=$targetWidget.index();var revisionId=ip.revisionId;if($targetWidget.hasClass("ipWidget-Columns")){alert("Not implemented yet")}else{ipContent.createWidget(revisionId,targetBlockName,"Columns",targetPosition,function(instanceId){var columnWidgetInstanceId=instanceId;var $columnWidget=$("#ipWidget-"+columnWidgetInstanceId);if(leftOrRight=="left"){var $existingWidgetBlock=$columnWidget.find(".ipBlock").eq(1);var $newWidgetBlock=$columnWidget.find(".ipBlock").eq(0)}else{var $existingWidgetBlock=$columnWidget.find(".ipBlock").eq(0);var $newWidgetBlock=$columnWidget.find(".ipBlock").eq(1)}var existingWidgetBlockName=$existingWidgetBlock.data("ipBlock").name;newWidgetBlockName=$newWidgetBlock.data("ipBlock").name;ipContent.moveWidget(targetWidgetInstanceId,0,existingWidgetBlockName,revisionId,function(newInstanceId){$("#ipWidget-"+newInstanceId).remove();$columnWidget.ipWidget("save",{},1,function($widget){$widget.closest(".ipBlock").find(".ipbExampleContent").remove();if(callback){callback(newWidgetBlockName)}})})})}};this.createWidget=function(revisionId,block,widgetName,position,callback){var data={};data.aa="Content.createWidget";data.securityToken=ip.securityToken;data.widgetName=widgetName;data.position=position;data.block=block;data.revisionId=revisionId;$.ajax({type:"POST",url:ip.baseUrl,data:data,success:function(response){if(response.status=="error"){alert(response.errorMessage)}var $block=$("#ipBlock-"+response.block);if(response.status=="success"){var $newWidget=$(response.widgetHtml);if(response.position==0){$block.prepend($newWidget)}else{$secondChild=$block.children(".ipWidget:nth-child("+response.position+")");$newWidget.insertAfter($secondChild)}$block.trigger("reinitRequired.ipWidget");$block.trigger("addWidget.ipWidget",{instanceId:response.instanceId,widget:$newWidget});$(document).ipContentManagement("initBlocks",$newWidget.find(".ipBlock"));var widgetController=$newWidget.ipWidget("widgetController");if(widgetController&&typeof(widgetController.onAdd)==="function"){widgetController.onAdd($newWidget)}}if($block.hasClass("ipbEmpty")){$block.removeClass("ipbEmpty")}if(callback){callback($newWidget.data("widgetinstanceid"))}},dataType:"json"})};this.moveWidget=function(instanceId,position,block,revisionId,callback){var data=Object();data.aa="Content.moveWidget";data.securityToken=ip.securityToken;data.instanceId=instanceId;data.position=position;data.blockName=block;data.revisionId=revisionId;$.ajax({type:"POST",url:ip.baseUrl,data:data,success:function(response){if(response.status=="error"){alert(response.errorMessage)}var $block=$("#ipBlock-"+response.block);$("#ipWidget-"+response.oldInstance).replaceWith(response.widgetHtml);$block.trigger("reinitRequired.ipWidget");if(callback){callback(response.newInstanceId)}},dataType:"json"})}}})(ip.jQuery);(function($){$(document).bind("initFinished.ipContentManagement",function(){$(".ipActionWidgetButton").bind("dragstart",function(event,ui){$(".ipBlock > .ipbExampleContent").each(function(){var $ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.css("min-height")){$block.data("ipMinHeight",$block.css("min-height"))}$block.css("min-height",$block.height());$ipExampleContent.fadeOut("slow")})}).bind("dragstop",function(event,ui){$(".ipBlock > .ipbExampleContent").each(function(){var $ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.children(".ipAdminWidgetPlaceholder").length){$ipExampleContent.remove()}else{$ipExampleContent.fadeIn("fast")}if(!$block.data("ipMinHeight")){$block.css("min-height","")}else{$block.css("min-height",$block.data("ipMinHeight"));$block.removeData("ipMinHeight")}})})})})(ip.jQuery);(function($){$.support.touch="ontouchend" in document;if(!$.support.touch){return}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,"mouseover");simulateMouseEvent(event,"mousemove");simulateMouseEvent(event,"mousedown")};mouseProto._touchMove=function(event){if(!touchHandled){return}this._touchMoved=true;simulateMouseEvent(event,"mousemove")};mouseProto._touchEnd=function(event){if(!touchHandled){return}simulateMouseEvent(event,"mouseup");simulateMouseEvent(event,"mouseout");if(!this._touchMoved){simulateMouseEvent(event,"click")}touchHandled=false};mouseProto._mouseInit=function(){var self=this;self.element.bind("touchstart",$.proxy(self,"_touchStart")).bind("touchmove",$.proxy(self,"_touchMove")).bind("touchend",$.proxy(self,"_touchEnd"));_mouseInit.call(self)}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var $list=$this.find(".ipsList");$list.html("");var $itemTemplate=$this.find(".ipsItemTemplate");$.each(options.layouts,function(key,value){var $newItem=$itemTemplate.clone().detach().text(value.title).data("layout",value.name);if(value.name==options.currentLayout){$newItem.addClass("active");$newItem.on("click",function(e){e.preventDefault();$this.modal("hide")})}else{$newItem.on("click",function(e){e.preventDefault();options.widgetObject.ipWidget("changeLook",value.name);$this.modal("hide")})}$list.append($newItem)});$this.modal()})}};$.fn.ipLayoutModal=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on ipLayoutModal")}}}})(ip.jQuery);var IpWidget_Columns;(function($){IpWidget_Columns=function(widgetObject){this.widgetObject=widgetObject;this.manageInit=manageInit;this.prepareData=prepareData;function manageInit(){var instanceData=this.widgetObject.data("ipWidget").data;if(instanceData.baseId){this.widgetObject.find('input[name="baseId"]').val(instanceData.baseId)}else{}}function prepareData(){var data={};data.baseId=this.widgetObject.find('input[name="baseId"]').val();data.columns=this.widgetObject.find('input[name="columns"]').val();$(this.widgetObject).trigger("preparedWidgetData.ipWidget",[data])}}})(ip.jQuery);var IpWidget_File;(function($){IpWidget_File=function(widgetObject){this.widgetObject=widgetObject;this.prepareData=prepareData;this.manageInit=manageInit;this.filesSelected=fileUploaded;this.addError=addError;function manageInit(){var instanceData=this.widgetObject.data("ipWidget");var uploader=this.widgetObject.find(".ipaUpload");var options=new Object;uploader.ipUploadFile(options);var container=this.widgetObject.find(".ipWidget_ipFile_container");var options=new Object;if(instanceData.data.files){options.files=instanceData.data.files}else{options.files=new Array()}options.fileTemplate=this.widgetObject.find(".ipaFileTemplate");container.ipWidget_ipFile_container(options);this.widgetObject.bind("filesSelected.ipUploadFile",this.filesSelected);this.widgetObject.bind("error.ipUploadFile",this.addError);var widgetObject=this.widgetObject;this.widgetObject.find(".ipmBrowseButton").click(function(e){e.preventDefault();var repository=new ipRepository({preview:"list"});repository.bind("ipRepository.filesSelected",$.proxy(fileUploaded,widgetObject))})}function addError(event,errorMessage){$(this).trigger("error.ipContentManagement",[errorMessage])}function fileUploaded(event,files){var $this=$(this);var container=$this.find(".ipWidget_ipFile_container");for(var index in files){container.ipWidget_ipFile_container("addFile",files[index].fileName,files[index].fileName,"new")}}function prepareData(){var data=Object();var container=this.widgetObject.find(".ipWidget_ipFile_container");data.files=new Array();var $files=container.ipWidget_ipFile_container("getFiles");$files.each(function(index){var $this=$(this);var tmpFile=new Object();tmpFile.title=$this.ipWidget_ipFile_file("getTitle");tmpFile.fileName=$this.ipWidget_ipFile_file("getFileName");tmpFile.status=$this.ipWidget_ipFile_file("getStatus");data.files.push(tmpFile)});$(this.widgetObject).trigger("preparedWidgetData.ipWidget",[data])}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipWidget_ipFile_container");var files=null;if(options.files){files=options.files}else{files=new Array()}if(!data){$this.data("ipWidget_ipFile_container",{files:files,fileTemplate:options.fileTemplate});for(var i in files){$this.ipWidget_ipFile_container("addFile",files[i]["fileName"],files[i]["title"],"present")}$this.bind("removeFile.ipWidget_ipFile",function(event,fileObject){var $fileObject=$(fileObject);$fileObject.ipWidget_ipFile_container("removeFile",$fileObject)});$(".ipWidget_ipFile_container").sortable();$(".ipWidget_ipFile_container").sortable("option","handle",".ipaFileMove")}})},addFile:function(fileName,title,status){var $this=this;var $newFileRecord=$this.data("ipWidget_ipFile_container").fileTemplate.clone();$newFileRecord.ipWidget_ipFile_file({status:status,fileName:fileName,title:title});$this.append($newFileRecord)},removeFile:function($fileObject){$fileObject.hide();$fileObject.ipWidget_ipFile_file("setStatus","deleted")},getFiles:function(){var $this=this;return $this.find(".ipaFileTemplate")}};$.fn.ipWidget_ipFile_container=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipWidget_ipFile_file");if(!data){var data={title:"",fileName:"",status:"new"};if(options.title){data.title=options.title}if(options.fileName){data.fileName=options.fileName}if(options.status){data.status=options.status}$this.data("ipWidget_ipFile_file",{title:data.title,fileName:data.fileName,status:data.status});$this.find(".ipaFileTitle").val(data.title)}$this.find(".ipaFileLink").attr("href",ipFileUrl("file/repository/"+data.fileName));$this.find(".ipaFileRemove").bind("click",function(event){event.preventDefault();$this=$(this);$this.trigger("removeClick.ipWidget_ipFile")});$this.bind("removeClick.ipWidget_ipFile",function(event){$this.trigger("removeFile.ipWidget_ipFile",this)});return $this})},getTitle:function(){var $this=this;return $this.find(".ipaFileTitle").val()},getFileName:function(){var $this=this;var tmpData=$this.data("ipWidget_ipFile_file");return tmpData.fileName},getStatus:function(){var $this=this;var tmpData=$this.data("ipWidget_ipFile_file");return tmpData.status},setStatus:function(newStatus){var $this=$(this);var tmpData=$this.data("ipWidget_ipFile_file");tmpData.status=newStatus;$this.data("ipWidget_ipFile_file",tmpData)}};$.fn.ipWidget_ipFile_file=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);var IpWidget_Gallery;(function($){IpWidget_Gallery=function(){this.$widgetObject=null;this.data=null;this.$controls=null;this.$widgetControls=null;this.init=function($widgetObject,data){var currentScope=this;this.$widgetObject=$widgetObject;this.data=data;this.$widgetControls=$("#ipWidgetGalleryControls");this.$widgetObject.on("click",$.proxy(this.focus,this));$("body").on("click",$.proxy(function(e){var $target=$(e.target);if(!$target.hasClass("ipWidget-Gallery")){$target=$target.closest(".ipWidget-Gallery")}if($target.length==0||$target.data("widgetinstanceid")!=this.$widgetObject.data("widgetinstanceid")){$.proxy(this.blur,this)()}},this));var $list=this.$widgetObject.find("ul");$list.sortable();$list.disableSelection();$list.on("sortstart",function(event,ui){currentScope.dragItemOriginalPosition=$(ui.item).index();$.proxy(currentScope.blurImage,currentScope)()});$list.on("sortstop",function(event,ui){var data={};data.method="move";data.originalPosition=currentScope.dragItemOriginalPosition;data.newPosition=$(ui.item).index();if(data.newPosition!=data.originalPosition){currentScope.$widgetObject.save(data,true)}else{$(ui.item).click()}});this.$widgetObject.find("a").on("click",function(e){e.preventDefault()});this.$widgetObject.find("li").on("click",$.proxy(this.focusImage,this));this.$controls=$("#ipWidgetGalleryMenu");$("body").on("click",$.proxy(function(e){var $target=$(e.target);var $closestLi=$target;if(!$target.prop("tagName")=="li"){$closestLi=$target.closest("li")}var $closestWidget=$closestLi.closest(".ipWidget-Gallery");if($closestWidget.length!=1){$.proxy(this.blurImage,this)()}},this))};this.onAdd=function(e){this.$widgetObject.click();var thisContext=this;var repository=new ipRepository({preview:"thumbnails",filter:"image"});repository.on("ipRepository.filesSelected",$.proxy(thisContext.filesSelected,thisContext));repository.on("ipModuleRepository.cancel",function(){ipContent.deleteWidget(thisContext.$widgetObject.data("widgetinstanceid"))})};this.focusImage=function(e){var context=this;e.preventDefault();var $li=$(e.currentTarget);var $img=$li.find("img");var $controls=this.$controls;$controls.removeClass("ipgHide");$controls.css("position","absolute");$controls.css("left",$img.offset().left+5);$controls.css("top",$img.offset().top+5);$controls.find(".ipsDelete").off().on("click",function(e){$.proxy(context.deleteImage,context)($li.index())})};this.blurImage=function(){this.$controls.addClass("ipgHide")};this.focus=function(){var thisContext=this;var $widgetControls=this.$widgetControls;var $widgetObject=this.$widgetObject;$widgetControls.removeClass("hide");$widgetControls.css("left",$widgetObject.offsetLeft);$widgetControls.css("top",$widgetObject.offsetTop);$widgetControls.css("position","absolute");$widgetControls.css("left",$widgetObject.offset().left);$widgetControls.css("top",$widgetObject.offset().top-$widgetControls.height()-5);$widgetControls.find(".ipsAdd").off().on("click",function(e){e.preventDefault();var repository=new ipRepository({preview:"thumbnails",filter:"image"});repository.on("ipRepository.filesSelected",$.proxy(thisContext.filesSelected,thisContext))})};this.blur=function(){var $widgetControls=this.$widgetControls;$widgetControls.addClass("hide")};this.deleteImage=function(position){if(!this.data.images[1]){ipContent.deleteWidget(this.$widgetObject.data("widgetinstanceid"));return}var data={};data.method="delete";data.position=position;this.$widgetObject.save(data,true)};this.filesSelected=function(event,files){var $this=$(this);var data=this.data;var data={method:"add"};$.each(files,function(key,value){if(!data.images){data.images=[]}data.images[data.images.length]={fileName:value.fileName,status:"new"}});this.$widgetObject.save(data,1,function($widget){$widget.click()})};function addError(event,errorMessage){$(this).trigger("error.ipContentManagement",[errorMessage])}function prepareData(){var data=Object();var container=this.widgetObject.find(".ipWidget_ipGallery_container");data.images=new Array();var $images=container.ipWidget_ipGallery_container("getImages");$images.each(function(index){var $this=$(this);var tmpImage=new Object();tmpImage.title=$this.ipWidget_ipGallery_image("getTitle");tmpImage.fileName=$this.ipWidget_ipGallery_image("getFileName");tmpImage.status=$this.ipWidget_ipGallery_image("getStatus");var tmpCropCoordinates=$this.ipWidget_ipGallery_image("getCropCoordinates");tmpImage.cropX1=tmpCropCoordinates.x1;tmpImage.cropY1=tmpCropCoordinates.y1;tmpImage.cropX2=tmpCropCoordinates.x2;tmpImage.cropY2=tmpCropCoordinates.y2;data.images.push(tmpImage)});$(this.widgetObject).trigger("preparedWidgetData.ipWidget",[data])}}})(ip.jQuery);var IpWidget_Text;(function($){IpWidget_Text=function(){this.$widgetObject=null;this.init=function($widgetObject,data){var customTinyMceConfig=ipTinyMceConfig();this.$widgetObject=$widgetObject;customTinyMceConfig.setup=function(ed,l){ed.on("change",function(e){$widgetObject.save({text:$widgetObject.find(".ipsContent").html()})})};$widgetObject.find(".ipsContent").tinymce(customTinyMceConfig)};this.onAdd=function(){this.$widgetObject.find(".ipsContent").focus()}}})(ip.jQuery);var IpWidget_Image;(function($){IpWidget_Image=function(){this.$widgetObject=null;this.$imageUploader=null;this.init=function($widgetObject,data){this.$widgetObject=$widgetObject;var $imageUploader=$('<div class="ipsImage ip"></div>');this.$widgetObject.append($imageUploader);this.$imageUploader=$imageUploader;var options=new Object;if(data.imageOriginal){options.image=data.imageOriginal}if(data.cropX1){options.cropX1=data.cropX1}if(data.cropY1){options.cropY1=data.cropY1}if(data.cropX2){options.cropX2=data.cropX2}if(data.cropY2){options.cropY2=data.cropY2}options.enableChangeHeight=true;options.enableChangeWidth=true;options.enableUnderscale=true;var $img=this.$widgetObject.find("img");if($img.length==1){options.windowWidth=$img.width();options.windowHeight=$img.height();$img.hide()}if(options.windowHeight==null){options.windowHeight=100}this.$imageUploader.ipUploadImage(options);this.$imageUploader.on("error.ipUploadImage",$.proxy(addError,this));this.$imageUploader.on("change.ipUploadImage",$.proxy(save,this))};var addError=function(event,errorMessage){$(this).trigger("error.ipContentManagement",errorMessage)};var save=function(){var data=Object();var ipUploadImage=this.$imageUploader;if(ipUploadImage.ipUploadImage("getNewImageUploaded")){var newImage=ipUploadImage.ipUploadImage("getCurImage");if(newImage){data.newImage=newImage}}if(ipUploadImage.ipUploadImage("getCropCoordinatesChanged")&&ipUploadImage.ipUploadImage("getCurImage")!=false){var cropCoordinates=ipUploadImage.ipUploadImage("getCropCoordinates");if(cropCoordinates){data.cropX1=cropCoordinates.x1;data.cropY1=cropCoordinates.y1;data.cropX2=cropCoordinates.x2;data.cropY2=cropCoordinates.y2;data.width=ipUploadImage.ipUploadImage("width");data.height=ipUploadImage.ipUploadImage("height")}}data.title=this.$widgetObject.find(".ipaImageTitle").val();this.$widgetObject.save(data)}}})(ip.jQuery);var IpWidget_Html;(function($){IpWidget_Html=function(){this.widgetObject=null;this.confirmButton=null;this.popup=null;this.data={};this.textarea=null;this.init=function(widgetObject,data){this.widgetObject=widgetObject;this.data=data;var container=this.widgetObject.find(".ipsContainer");if(this.data.html){container.html(this.data.html)}var context=this;container.click(function(){$.proxy(openPopup,context)()})};this.onAdd=function(){$.proxy(openPopup,this)()};var openPopup=function(){this.popup=$("#ipWidgetHtmlPopup");this.confirmButton=this.popup.find(".ipsConfirm");this.textarea=this.popup.find("textarea[name=html]");if(this.data.html){this.textarea.val(this.data.html)}else{this.textarea.val("")}this.popup.modal();this.confirmButton.off();this.confirmButton.on("click",$.proxy(save,this))};var save=function(){var data={html:this.textarea.val()};this.widgetObject.save(data,1);this.popup.modal("hide")}}})(ip.jQuery);(function($){var methods={init:function(options){if(typeof options!=="object"){options={}}return this.each(function(){var $this=$(this);var data=$this.data("ipWidget_ipForm_field");if(!data){var data={label:"",type:"Text",required:false,status:"new",options:{}};if(options.label){data.label=options.label}if(options.type){data.type=options.type}if(options.required&&options.required!="0"&&options.required!="false"){data.required=1}else{data.required=0}if(options.status){data.status=options.status}$this.data("ipWidget_ipForm_field",{label:data.label,type:data.type,required:data.required,status:data.status,optionsPopup:options.optionsPopup});$this.find(".ipaFieldLabel").val(data.label);$this.find(".ipaFieldType").val(data.type);$this.find(".ipaFieldType").bind("change",function(){$(this).trigger("changeType.ipWidget_ipForm",[$(this).val()])});$this.bind("changeType.ipWidget_ipForm",function(e,type){$(this).ipWidget_ipForm_field("setType",type)});$(this).ipWidget_ipForm_field("setType",data.type);if(options.options){$this.ipWidget_ipForm_field("setOptions",options.options)}if(options.required&&options.required!=0){$this.find(".ipaFieldRequired").attr("checked",options.required)}}var $thisForEvent=$this;$this.find(".ipaFieldRemove").bind("click",function(event){$thisForEvent.ipWidget_ipForm_field("setStatus","deleted");$thisForEvent.hide();event.preventDefault()});return $this})},openOptionsPopup:function(){var $this=this;var data=$this.data("ipWidget_ipForm_field");var $thisForEvent=$this;data.optionsPopup.bind("saveOptions.ipWidget_ipForm",function(e,options){$this=$(this);$this.unbind("saveOptions.ipWidget_ipForm");$thisForEvent.ipWidget_ipForm_field("setOptions",options)});data.optionsPopup.ipWidget_ipForm_options("showOptions",data.type,$this.ipWidget_ipForm_field("getOptions"))},setOptions:function(options){var $this=this;var data=$this.data("ipWidget_ipForm_field");if(!data.options){data.options={}}data.options[$this.ipWidget_ipForm_field("getType")]=options;$this.data("ipWidget_ipForm_field",data)},getOptions:function(){var $this=$(this);var data=$this.data("ipWidget_ipForm_field");if(data.options&&data.options[$this.ipWidget_ipForm_field("getType")]){return data.options[$this.ipWidget_ipForm_field("getType")]}else{return null}},getLabel:function(){var $this=this;return $this.find(".ipaFieldLabel").val()},getType:function(){var $this=this;return $this.find(".ipaFieldType").val()},setType:function(type){var $this=this;var data=$this.data("ipWidget_ipForm_field");if(data.optionsPopup.ipWidget_ipForm_options("optionsAvailable",type)){$this.find(".ipaFieldOptions").css("visibility","visible");$this.find(".ipaFieldOptions").bind("click",function(){$(this).trigger("optionsClick.ipWidget_ipForm");return false});$this.bind("optionsClick.ipWidget_ipForm",function(){$(this).ipWidget_ipForm_field("openOptionsPopup")})}else{$this.find(".ipaFieldOptions").css("visibility","hidden")}data.type=type;$this.data("ipWidget_ipForm_field",data)},getStatus:function(){var $this=this;var tmpData=$this.data("ipWidget_ipForm_field");return tmpData.status},setStatus:function(newStatus){var $this=this;var tmpData=$this.data("ipWidget_ipForm_field");tmpData.status=newStatus;$this.data("ipWidget_ipForm_field",tmpData)},getRequired:function(){var $this=$(this);return $this.find(".ipaFieldRequired").is(":checked")}};$.fn.ipWidget_ipForm_field=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);(function($){var methods={init:function(options){if(!options){options={}}return this.each(function(){var $this=$(this);var data=$this.data("ipWidget_ipForm_options");if(!data){var data={fieldTypes:options.fieldTypes};$this.data("ipWidget_ipForm_options",data)}return $this})},showOptions:function(fieldType,currentOptions){var $this=this;var fieldType=$this.ipWidget_ipForm_options("getFieldType",fieldType);$this.html(fieldType.optionsHtml);$this.dialog({modal:true,buttons:{Save:function(){var $this=$(this);eval("var options = "+fieldType.optionsSaveFunction+"($this);");$this.dialog("close");$this.trigger("saveOptions.ipWidget_ipForm",[options])},Cancel:function(){$(this).dialog("close")}}});eval(""+fieldType.optionsInitFunction+"($this, currentOptions);")},getFieldType:function(fieldType){var $this=this;var data=$this.data("ipWidget_ipForm_options");return data.fieldTypes[fieldType]},optionsAvailable:function(fieldTypeKey){var $this=this;var fieldType=$this.ipWidget_ipForm_options("getFieldType",fieldTypeKey);return(fieldType&&(fieldType.optionsInitFunction||fieldType.optionsHtml))}};$.fn.ipWidget_ipForm_options=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);var IpWidget_Form;(function($){IpWidget_Form=function(){this.data=null;this.modal=null;this.container=null;this.addButton=null;this.confirmButton=null;this.init=function($widgetObject,data){this.data=data;this.widgetObject=$widgetObject;var $widgetOverlay=$("<div></div>").css("position","absolute").css("z-index",5).width(this.widgetObject.width()).height(this.widgetObject.height());this.widgetObject.prepend($widgetOverlay);$widgetOverlay.on("click",$.proxy(openPopup,this))};var openPopup=function(){this.modal=$("#ipWidgetFormPopup");this.addButton=this.modal.find(".ipaFieldAdd");this.container=this.modal.find(".ipWidget_ipForm_container");this.confirmButton=this.modal.find(".ipsConfirm");this.modal.modal();this.modal.on("hidden.bs.modal",$.proxy(cleanup,this));this.confirmButton.on("click",$.proxy(save,this));var instanceData=this.data;var options=new Object;if(instanceData.fields){options.fields=instanceData.fields}else{options.fields=new Array()}options.fieldTemplate=this.modal.find(".ipaFieldTemplate");options.optionsPopup=this.modal.find(".ipaFieldOptionsPopup").ipWidget_ipForm_options({fieldTypes:instanceData.fieldTypes});this.container.ipWidget_ipForm_container(options);this.addButton.on("click",$.proxy(addField,this))};var cleanup=function(){this.container.html("");this.container.ipWidget_ipForm_container("destroy");this.addButton.off();this.confirmButton.off()};var addField=function(e){this.container.ipWidget_ipForm_container("addField")};var save=function(e){var data=this.getData();this.widgetObject.save(data,1);this.modal.modal("hide")};this.getData=function(){var data=Object();data.fields=new Array();var $fields=this.container.ipWidget_ipForm_container("getFields");$fields.each(function(index){var $this=$(this);var tmpField=new Object();tmpField.label=$this.ipWidget_ipForm_field("getLabel");tmpField.type=$this.ipWidget_ipForm_field("getType");tmpField.options=$this.ipWidget_ipForm_field("getOptions");if($this.ipWidget_ipForm_field("getRequired")){tmpField.required=1}else{tmpField.required=0}var status=$this.ipWidget_ipForm_field("getStatus");if(status!="deleted"){data.fields.push(tmpField)}});data.success=this.widgetObject.find(".ipWidgetFormSuccess").html();return data}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipWidget_ipForm_container");var fields=null;if(options.fields){fields=options.fields}else{fields=new Array()}if(!data){$this.data("ipWidget_ipForm_container",{fields:fields,fieldTemplate:options.fieldTemplate,optionsPopup:options.optionsPopup});if(!fields instanceof Array){fields=new Array()}for(var i in fields){$this.ipWidget_ipForm_container("addField",fields[i])}$this.sortable();$this.sortable("option","handle",".ipaFieldMove")}})},addField:function(fieldData){var $this=this;if(typeof fieldData!=="object"){fieldData={}}var data=fieldData;data.optionsPopup=$this.data("ipWidget_ipForm_container").optionsPopup;var $newFieldRecord=$this.data("ipWidget_ipForm_container").fieldTemplate.clone();$newFieldRecord.ipWidget_ipForm_field(data);$this.append($newFieldRecord)},getFields:function(){var $this=this;return $this.find(".ipaFieldTemplate")},destroy:function(){return this.each(function(){var $this=this;$.removeData($this,"ipWidget_ipForm_container")})}};$.fn.ipWidget_ipForm_container=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(ip.jQuery);var IpWidget_TextImage;(function($){IpWidget_TextImage=function(widgetObject){this.widgetObject=widgetObject;this.prepareData=prepareData;this.addError=addError;this.manageInit=function(){this.widgetObject.find(".ipwText").tinymce(ipTinyMceConfig())};function prepareData(){var data=Object();var ipUploadImage=this.widgetObject.find(".ipaImage");if(ipUploadImage.ipUploadImage("getNewImageUploaded")){var newImage=ipUploadImage.ipUploadImage("getCurImage");if(newImage){data.newImage=newImage}}if(ipUploadImage.ipUploadImage("getCropCoordinatesChanged")&&ipUploadImage.ipUploadImage("getCurImage")!=false){var cropCoordinates=ipUploadImage.ipUploadImage("getCropCoordinates");if(cropCoordinates){data.cropX1=cropCoordinates.x1;data.cropY1=cropCoordinates.y1;data.cropX2=cropCoordinates.x2;data.cropY2=cropCoordinates.y2}}data.text=$(this.widgetObject).find("textarea").first().val();data.title=$(this.widgetObject).find(".ipaImageTitle").first().val();$(this.widgetObject).trigger("preparedWidgetData.ipWidget",[data])}function addError(event,errorMessage){$(this).trigger("error.ipContentManagement",errorMessage)}}})(ip.jQuery);var IpWidget_Faq;(function($){IpWidget_Faq=function(widgetObject){this.widgetObject=widgetObject;this.manageInit=manageInit;this.prepareData=prepareData;function manageInit(){var instanceData=this.widgetObject.data("ipWidget");this.widgetObject.find("textarea").tinymce(ipTinyMceConfig())}function prepareData(){var data=Object();data.answer=this.widgetObject.find(".ipAdminTextarea").html();data.question=this.widgetObject.find(".ipAdminInput").val();$(this.widgetObject).trigger("preparedWidgetData.ipWidget",[data])}}})(ip.jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var saveCallback=options.saveCallback;$this.modal();$this.find(".ipsConfirm").on("click",function(){saveCallback({anchor:$this.find(".ipsAnchor").val()});$this.modal("hide")});$this.find(".ipsAnchor").on("keydown",$.proxy(methods.updateAnchor,$this));$this.find(".ipsAnchor").on("change",$.proxy(methods.updateAnchor,$this));$this.find(".ipsAnchor").on("keyup",$.proxy(methods.updateAnchor,$this));$this.find(".ipsAnchor").val(options.anchor)})},updateAnchor:function(){this.each(function(){var $this=$(this);var $preview=$this.find(".ipsAnchorPreview");var curText=$preview.text();var newText=curText.split("#")[0]+"#"+$this.find(".ipsAnchor").val();$preview.text(newText)})},destroy:function(){return this.each(function(){})}};$.fn.ipWidgetTitleModal=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on ipWidgetTitleModal")}}}})(ip.jQuery);var IpWidget_Title;(function($){IpWidget_Title=function(){this.$widgetObject=null;this.data=null;this.$header=null;this.$controls=null;this.init=function($widgetObject,data){var thisScope=this;this.$widgetObject=$widgetObject;this.data=data;this.$header=$widgetObject.find("h1,h2,h3,h4,h5,h6");this.$controls=$("#ipWidgetTitleControls");this.$header.tinymce(this.tinyMceConfig());this.$header.on("focus",$.proxy(this.focus,this));this.$header.on("blur",$.proxy(this.blur,this));if(!data.level){this.data.level=1}this.$widgetObject.on("remove",$.proxy(this.destroy,this))};this.onAdd=function(){this.$widgetObject.find("h1,h2,h3,h4,h5,h6").focus()};this.focus=function(){this.initControls()};this.blur=function(e){if($(e.relatedTarget).hasClass("ipsH")||$(e.relatedTarget).hasClass("ipsOptions")){return}this.removeControls()};this.removeControls=function(){this.$controls.addClass("hide");this.$controls.find(".ipsH").off();this.$controls.find(".ipsOptions").off()};this.destroy=function(){this.removeControls()};this.saveOptions=function(data){this.data.anchor=data.anchor;this.save(false)};this.openOptions=function(){var $modal=$("#ipWidgetTitleOptions");$modal.removeClass("hide");$modal.ipWidgetTitleModal({anchor:this.data.anchor,saveCallback:$.proxy(this.saveOptions,this)})};this.initControls=function(){var $controls=this.$controls;var $widgetObject=this.$widgetObject;$controls.removeClass("hide");$controls.css("left",$widgetObject.offsetLeft);$controls.css("top",$widgetObject.offsetTop);$controls.css("position","absolute");$controls.css("left",$widgetObject.offset().left);$controls.css("top",$widgetObject.offset().top-$controls.height()-5);$controls.find(".ipsH").on("click",$.proxy(this.levelPressed,this));$controls.find(".ipsH").removeClass("active");$controls.find('.ipsH[data-level="'+this.data.level+'"]').addClass("active");$controls.find(".ipsOptions").on("click",$.proxy(this.openOptions,this))};this.levelPressed=function(e){this.removeControls();this.data.level=$(e.currentTarget).data("level");this.save(true)};this.save=function(refresh){var saveData={title:this.$widgetObject.find("h1,h2,h3,h4,h5,h6").text(),level:this.data.level,anchor:this.data.anchor};this.$widgetObject.save(saveData,refresh,function($widget){$widget.find("h1,h2,h3,h4,h5,h6").focus()})};this.tinyMceConfig=function(){var self=this;var customTinyMceConfig=ipTinyMceConfig();customTinyMceConfig.menubar=false;customTinyMceConfig.toolbar=false;customTinyMceConfig.setup=function(ed,l){ed.on("change",function(){$.proxy(self.save,self)(false)})};customTinyMceConfig.paste_as_text=true;customTinyMceConfig.valid_elements="";customTinyMceConfig.custom_shortcuts=false;return customTinyMceConfig}}})(ip.jQuery);