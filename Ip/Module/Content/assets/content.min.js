/*!
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
(function($){$.support.touch="ontouchend" in document;if(!$.support.touch){return}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent)}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,"mouseover");simulateMouseEvent(event,"mousemove");simulateMouseEvent(event,"mousedown")};mouseProto._touchMove=function(event){if(!touchHandled){return}this._touchMoved=true;simulateMouseEvent(event,"mousemove")};mouseProto._touchEnd=function(event){if(!touchHandled){return}simulateMouseEvent(event,"mouseup");simulateMouseEvent(event,"mouseout");if(!this._touchMoved){simulateMouseEvent(event,"click")}touchHandled=false};mouseProto._mouseInit=function(){var self=this;self.element.bind("touchstart",$.proxy(self,"_touchStart")).bind("touchmove",$.proxy(self,"_touchMove")).bind("touchend",$.proxy(self,"_touchEnd"));_mouseInit.call(self)}})(jQuery);$(document).ready(function(){$(document).bind("initFinished.ipContentManagement",function(){$(".ipActionWidgetButton").bind("dragstart",function(event,ui){$(".ipBlock > .ipbExampleContent").each(function(){$ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.css("min-height")){$block.data("ipMinHeight",$block.css("min-height"))}$block.css("min-height",$block.height());$ipExampleContent.fadeOut("slow")})}).bind("dragstop",function(event,ui){$(".ipBlock > .ipbExampleContent").each(function(){$ipExampleContent=$(this);var $block=$ipExampleContent.parent();if($block.children(".ipAdminWidgetPlaceholder").length){$ipExampleContent.remove()}else{$ipExampleContent.fadeIn("fast")}if(!$block.data("ipMinHeight")){$block.css("min-height","")}else{$block.css("min-height",$block.data("ipMinHeight"));$block.removeData("ipMinHeight")}})})})});$(document).ready(function(){$ipObject=$(document);$ipObject.bind("initFinished.ipContentManagement",ipAdminPanelInit);$ipObject.bind("initFinished.ipContentManagement",ipAdminWidgetsScroll);$(window).bind("resizeEnd",ipAdminWidgetsScroll);$ipObject.bind("initFinished.ipContentManagement",ipAdminWidgetsSearch);$ipObject.ipContentManagement();jQuery.expr[":"].icontains=function(a,i,m){return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0};if(isMobile){$("body").addClass("ipMobile")}});$(window).resize(function(){if(this.resizeTO){clearTimeout(this.resizeTO)}this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},100)});function ipAdminWidgetsScroll(){var $scrollable=$(".ipAdminWidgetsContainer");$scrollable.scrollable({items:"li",touch:false});var scrollableAPI=$scrollable.data("scrollable");var itemWidth=scrollableAPI.getItems().eq(0).outerWidth(true);var containerWidth=scrollableAPI.getRoot().width()+24;var scrollBy=Math.floor(containerWidth/itemWidth);if(scrollBy<1){scrollBy=1}$(".ipAdminWidgets .ipaRight, .ipAdminWidgets .ipaLeft").unbind("click");scrollableAPI.begin();$(".ipAdminWidgets .ipaRight").click(function(event){event.preventDefault();scrollableAPI.move(scrollBy)});$(".ipAdminWidgets .ipaLeft").click(function(event){event.preventDefault();scrollableAPI.move(-scrollBy)})}function ipAdminWidgetsSearch(){var $input=$(".ipAdminWidgetsSearch .ipaInput");var $button=$(".ipAdminWidgetsSearch .ipaButton");var $widgets=$(".ipAdminWidgetsContainer li");$input.focus(function(){if(this.value==this.defaultValue){this.value=""}}).blur(function(){if(this.value==""){this.value=this.defaultValue}}).keyup(function(){var value=this.value;$widgets.css("display","");if(value&&value!=this.defaultValue){$widgets.not(":icontains("+value+")").css("display","none");$button.addClass("ipaClear")}else{$button.removeClass("ipaClear")}ipAdminWidgetsScroll()});$button.click(function(event){event.preventDefault();$this=$(this);if($this.hasClass("ipaClear")){$input.val("").blur().keyup();$this.removeClass("ipaClear")}})}function ipAdminPanelInit(){$container=$(".ipAdminPanelContainer");$panel=$(".ipAdminPanel");$container.height($panel.height());$panel.css("top",$(".ipsAdminToolbarContainer").outerHeight())}function ipSaveJob(title,timeLeft){var title;var predictedTime;var progress;var finished;this.title=title;this.timeLeft=timeLeft;this.progress=0;this.finished=false;this.setTitle=setTitle;this.setProgress=setProgress;this.setTimeLeft=setTimeLeft;this.setFinished=setFinished;this.getTitle=getTitle;this.getProgress=getProgress;this.getTimeLeft=getTimeLeft;this.getFinished=getFinished;function setTitle(title){this.title=title}function setProgress(progress){if(progress>1){progress=1}if(progress<0){progress=0}this.progress=progress}function setTimeLeft(timeLeft){if(timeLeft<0){timeLeft=0}this.timeLeft=timeLeft}function setFinished(finished){this.finished=finished;this.setTimeLeft(0);this.setProgress(100)}function getTitle(){return this.title}function getProgress(){return this.progress}function getTimeLeft(){return this.timeLeft}function getFinished(){return this.finished}}(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipBlock");if(!data){$this.delegate(".ipActionWidgetMove","click",function(e){e.preventDefault()});$this.sortable({connectWith:".ipBlock",revert:true,dropOnEmpty:true,forcePlaceholderSize:false,placeholder:"ipAdminWidgetPlaceholder",handle:".ipAdminWidgetControls .ipActionWidgetMove",start:function(event,ui){ui.item.addClass("ipAdminWidgetDrag");ui.item.width(ui.item.find(".ipAdminWidgetMoveIcon").outerWidth());ui.item.height(ui.item.find(".ipAdminWidgetMoveIcon").outerHeight())},stop:function(event,ui){ui.item.removeClass("ipAdminWidgetDrag");ui.item.width("auto");ui.item.height("auto")},update:function(event,ui){if(!$(ui.item).data("widgetinstanceid")){return}if($(ui.item).parent().data("ipBlock").name!=$this.data("ipBlock").name){return}var instanceId=$(ui.item).data("widgetinstanceid");var position=$(ui.item).index();var data=Object();data.aa="Content.moveWidget";data.securityToken=ip.securityToken;data.instanceId=instanceId;data.position=position;data.blockName=$this.data("ipBlock").name;data.revisionId=$this.data("ipBlock").revisionId;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:methods._moveWidgetResponse,dataType:"json"})},receive:function(event,ui){$element=$(ui.item);if($element&&$element.is(".ipActionWidgetButton")){$duplicatedDragItem=$(".ipBlock .ipActionWidgetButton");$position=$duplicatedDragItem.index();var newWidgetName=$element.data("ipAdminWidgetButton").name;$duplicatedDragItem.remove();$block=$this;$block.ipBlock("_createWidget",newWidgetName,$position)}}});$this.data("ipBlock",{name:$this.attr("id").substr(8),revisionId:$this.data("revisionid"),widgetControlsHtml:options.widgetControlsHtml});var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data("ipBlock").widgetControlsHtml;$this.children(".ipWidget").ipWidget(widgetOptions);$this.delegate(".ipWidget .ipActionWidgetDelete","click",function(event){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}event.preventDefault();$(this).trigger("deleteClick.ipBlock")});$this.delegate(".ipWidget","deleteClick.ipBlock",function(event){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}var $instance=$(this),instanceData=$instance.data("widgetdata"),instanceId=$instance.data("widgetinstanceid"),$subwidgets=$instance.find(".ipWidget");$subwidgets.each(function(){$(this).trigger("deleteWidget.ipBlock",{instanceId:$(this).data("widgetinstanceid")})});$instance.trigger("deleteWidget.ipBlock",{instanceId:instanceId})});$this.bind("deleteWidget.ipBlock",function(event,data){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}$(this).ipBlock("deleteWidget",data.instanceId)});$this.bind("reinitRequired.ipWidget",function(event){if($(event.target).closest(".ipBlock")[0]!=$this[0]){return}$(this).ipBlock("reinit")})}})},reinit:function(){return this.each(function(){var $this=$(this);var widgetOptions=new Object;widgetOptions.widgetControlls=$this.data("ipBlock").widgetControlsHtml;$(this).children(".ipWidget").ipWidget(widgetOptions)})},_moveWidgetResponse:function(response){var $this=$(this);if(response.status=="success"){$("#ipWidget-"+response.oldInstance).replaceWith(response.widgetHtml);$this.trigger("reinitRequired.ipWidget")}},pageSaveStart:function(){return this.each(function(){var $this=$(this);$(this).children(".ipWidget").ipWidget("fetchManaged").ipWidget("save")})},destroy:function(){},_showError:function(errorMessage){alert(errorMessage)},deleteWidget:function(instanceId){return this.each(function(){var $this=$(this);var data=Object();data.aa="Content.deleteWidget";data.securityToken=ip.securityToken;data.instanceId=instanceId;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:methods._deleteWidgetResponse,dataType:"json"})})},_deleteWidgetResponse:function(response){var $this=$(this);$this.find("#ipWidget-"+response.widgetId).remove();if($this.children(".ipWidget").length==0){$this.addClass("ipbEmpty")}},_createWidget:function(widgetName,position){return this.each(function(){var $this=$(this);var data=Object();data.aa="Content.createWidget";data.securityToken=ip.securityToken;data.widgetName=widgetName;data.position=position;data.blockName=$this.data("ipBlock").name;data.zoneName=$this.data("ipBlock").zoneName;data.pageId=$this.data("ipBlock").pageId;data.revisionId=$this.data("ipBlock").revisionId;$.ajax({type:"POST",url:ip.languageUrl,data:data,context:$this,success:methods._createWidgetResponse,dataType:"json"})})},_createWidgetResponse:function(response){var $this=$(this);if(response.status=="error"){$.fn.ipBlock("_showError",response.errorMessage)}if(response.status=="success"){var $newWidget=$(response.widgetManagementHtml);if(response.position==0){$(this).prepend($newWidget)}else{$secondChild=$(this).children(".ipWidget:nth-child("+response.position+")");$($newWidget).insertAfter($secondChild)}$this.trigger("reinitRequired.ipWidget");$this.trigger("stateManagement.ipWidget",{instanceId:response.instanceId})}if($this.hasClass("ipbEmpty")){$this.removeClass("ipbEmpty")}}};$.fn.ipBlock=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipContentManagement");if(!data){$this.bind("initFinished.ipContentManagement",$.proxy(methods._initBlocks,$this));$(this).trigger("initStarted.ipContentManagement");$this.data("ipContentManagement",{saveJobs:Object(),optionsChanged:false});var data=$this.data("ipContentManagement");$("body").prepend(ipContentInit.saveProgressHtml);$("body").prepend(ipContentInit.controlPanelHtml);var options=new Object;options.zoneName=ip.zoneName;options.pageId=ip.pageId;options.revisionId=ip.revisionId;options.widgetControlsHtml=ipContentInit.widgetControlsHtml;options.contentManagementObject=$this;options.manageableRevision=ipContentInit.manageableRevision;var data=$this.data("ipContentManagement");data.initInfo=options;$this.data("ipContentManagement",data);$(".ipAdminPanel .ipActionWidgetButton").ipAdminWidgetButton();$(".ipAdminPanel .ipaOptions").bind("click",function(event){event.preventDefault();$(this).trigger("pageOptionsClick.ipContentManagement")});$(".ipAdminPanel .ipActionSave").bind("click",function(e){$.proxy(methods.save,$this)(false)});$(".ipAdminPanel .ipActionPublish").bind("click",function(e){$.proxy(methods.save,$this)(true)});$(".ipAdminPanelContainer .ipsPreview").on("click",function(e){e.preventDefault();ipContent.setManagementMode(0)});$this.bind("pageOptionsClick.ipContentManagement",function(event){$(this).ipContentManagement("openPageOptions")});$this.bind("pageOptionsConfirm.ipPageOptions",methods._optionsConfirm);$this.bind("pageOptionsCancel.ipPageOptions",methods._optionsCancel);$this.bind("error.ipContentManagement",function(event,error){$(this).ipContentManagement("addError",error)});$this.trigger("initFinished.ipContentManagement",options)}})},_initBlocks:function(){var $this=this;$this.ipContentManagement("initBlocks",$(".ipBlock"))},initBlocks:function(blocks){var $this=this;var data=$this.data("ipContentManagement");var options=data.initInfo;if(options.manageableRevision){blocks.ipBlock(options)}},addError:function(errorMessage){var $newError=$(".ipAdminErrorSample .ipAdminError").clone();$newError.text(errorMessage);$(".ipAdminErrorContainer").append($newError);$newError.animate({opacity:"100%"},6000).animate({queue:true,opacity:"0%"},{duration:3000,complete:function(){$(this).remove()}})},openPageOptions:function(){return this.each(function(){var $this=$(this);if($(".ipaOptionsDialog").length){$this.find(".ipaOptionsDialog").dialog("open")}else{$(".ipAdminPanel").append('<div class="ipaOptionsDialog" style="display: none;"></div>');$(".ipaOptionsDialog").dialog({width:600,height:450,modal:true});$(".ipaOptionsDialog").ipPageOptions();$(".ipaOptionsDialog").ipPageOptions("refreshPageData",ip.pageId,ip.zoneName)}})},_optionsConfirm:function(event){var $this=$(this);var data=$this.data("ipContentManagement");var postData=Object();postData.aa="Content.savePageOptions";postData.securityToken=ip.securityToken;postData.pageOptions=$(".ipaOptionsDialog").ipPageOptions("getPageOptions");postData.revisionId=ip.revisionId;$.ajax({type:"POST",url:ip.baseUrl,data:postData,context:$this,success:methods._savePageOptionsResponse,dataType:"json"})},_savePageOptionsResponse:function(response){$this=this;if(response.status=="success"){$(".ipaOptionsDialog").remove();if(response.newUrl&&response.newUrl!=""){$('a[href="'+response.oldUrl+'"]').attr("href",response.newUrl)}}else{alert(response.errorMessage)}},_optionsCancel:function(event){var $this=$(this);$(".ipaOptionsDialog").remove()},save:function(publish){return this.each(function(){var $this=$(this);var data=$this.data("ipContentManagement");var postData=Object();postData.aa="Content.savePage";postData.securityToken=ip.securityToken;postData.revisionId=ip.revisionId;if(publish){postData.publish=1}else{postData.publish=0}$.ajax({type:"POST",url:ip.baseUrl,data:postData,context:$this,success:methods._savePageResponse,dataType:"json"})})},_savePageResponse:function(response){var $this=$(this);var data=$this.data("ipContentManagement");if(response.status=="success"){window.location.href=response.newRevisionUrl}else{}}};$.fn.ipContentManagement=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipPageOptions");if(!data){$this.data("ipPageOptions",{})}})},refreshPageData:function(pageId,zoneName){var $this=this;var data=Object();data.aa="Content.getPageOptionsHtml";data.securityToken=ip.securityToken;data.pageId=pageId;data.zoneName=zoneName;$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:methods._refreshPageDataResponse,dataType:"json"})},_refreshPageDataResponse:function(response){var $this=this;if(response.status=="success"){$this.html(response.optionsHtml);$this.tabs()}$(".ipaOptionsConfirm").bind("click",methods._confirm);$(".ipaOptionsCancel").bind("click",methods._cancel)},_confirm:function(event){var $this=$(this);$this.trigger("pageOptionsConfirm.ipPageOptions")},_cancel:function(event){var $this=$(this);$this.trigger("pageOptionsCancel.ipPageOptions")},getPageOptions:function(){var data=Object();data.buttonTitle=$('#formGeneral input[name="buttonTitle"]').val();data.visible=$('#formGeneral input[name="visible"]').attr("checked")?1:0;data.createdOn=$('#formGeneral input[name="createdOn"]').val();data.lastModified=$('#formGeneral input[name="lastModified"]').val();data.pageTitle=$('#formSEO input[name="pageTitle"]').val();data.keywords=$('#formSEO textarea[name="keywords"]').val();data.description=$('#formSEO textarea[name="description"]').val();data.url=$('#formSEO input[name="url"]').val();data.type=$('#formAdvanced input:checked[name="type"]').val();data.redirectURL=$('#formAdvanced input[name="redirectURL"]').val();data.layout=$('#formLayout select[name="layout"]').val();return data}};$.fn.ipPageOptions=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipPageOptions")}}}})(jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);var data=$this.data("ipAdminWidgetButton");if(!data){$this.draggable({connectToSortable:".ipBlock",revert:function(droppable){if(droppable===false){$this.trigger("unsuccessfulDrop.ipWidgetButton",{widgetButton:$this});return true}else{$this.trigger("successfulDrop.ipWidgetButton",{widgetButton:$this,block:droppable});return false}},helper:"clone",stop:function(event,ui){}});$this.data("ipAdminWidgetButton",{name:$this.attr("id").substr(20)})}$this.find("a").bind("click",function(){return false})})},destroy:function(){}};$.fn.ipAdminWidgetButton=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipAdminWidgetButton")}}}})(jQuery);(function($){var methods={init:function(options){return this.each(function(){var $this=$(this);$this.prepend(options.widgetControlls);$this.save=function(data,refresh){$(this).ipWidget("save",data,refresh)};var data=$this.data("ipWidgetInit");if(!data){$this.data("ipWidgetInit",Object());var widgetName=$this.data("widgetname");var data=$this.data("widgetdata");if(eval("typeof IpWidget_"+widgetName+" == 'function'")){var widgetPluginObject;eval("widgetPluginObject = new IpWidget_"+widgetName+"();");if(widgetPluginObject.init){widgetPluginObject.init($this,data)}}}})},save:function(widgetData,refresh){return this.each(function(){var $this=$(this);var data=Object();data.aa="Content.updateWidget";data.securityToken=ip.securityToken;data.instanceId=$this.data("widgetinstanceid");data.widgetData=widgetData;data.layout="default";$.ajax({type:"POST",url:ip.baseUrl,data:data,context:$this,success:function(response){if(!refresh){return}var $newWidget=$(response.previewHtml);$($newWidget).insertAfter($this);$newWidget.trigger("reinitRequired.ipWidget");$(document).ipContentManagement("initBlocks",$newWidget.find(".ipBlock"));$this.remove()},error:function(response){console.log(response)},dataType:"json"})})},refresh:function(widgetData){return this.each(function(){})}};$.fn.ipWidget=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.ipWidget")}}}})(jQuery);$(document).ready(function(){ipContentLayouts.init()});var ipContentLayouts=new function(){this.init=function(){}};